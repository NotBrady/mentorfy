{"id":"mentorfy-03m","title":"Handle returning user flow","description":"Implement UI flow when backend detects a returning user.\n\n**Current state:**\n- Backend PATCH returns `{ returning: true, existingSessionId }` when email matches existing session\n- Frontend doesn't handle this response\n\n**Changes needed:**\n1. After contact form submission, check for `returning: true` in response\n2. If returning user detected:\n   - Option A: Show \"Welcome back!\" message and continue with existing session\n   - Option B: Ask user if they want to continue previous session or start fresh\n3. If continuing existing session:\n   - Fetch existing session data with `GET /api/session/[existingSessionId]`\n   - Hydrate UserContext with existing context\n   - Resume from where they left off\n\n**Backend endpoints:**\n- `PATCH /api/session/[id]` - returns returning user flag\n- `GET /api/session/[id]` - fetches full session including context\n\n**Files to modify:**\n- Contact form submission handler\n- UserContext (to support hydration from backend)\n\n**Depends on:** mentorfy-64p (contact sync)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T21:09:37.994666512Z","created_by":"eli","updated_at":"2026-01-02T15:27:12.342198-08:00","closed_at":"2026-01-02T22:40:07.023861903Z"}
{"id":"mentorfy-06l","title":"Phase 3: Wire up app routes + API route","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T22:12:27.924295-08:00","created_by":"elijah","updated_at":"2025-12-29T22:56:50.347608-08:00","closed_at":"2025-12-29T22:56:50.347608-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mentorfy-06l","depends_on_id":"mentorfy-nv0","type":"blocks","created_at":"2025-12-29T22:12:38.986149-08:00","created_by":"daemon"}]}
{"id":"mentorfy-0dv","title":"Back button visible on Step 7 Q4 Vision (first step of Phase E)","description":"## Bug Description\n\nBack button is rendered on Step 7 (Q4 Vision) but should NOT be rendered because it's the first step of Phase E. Users should not be able to go back from Phase E to Phase D (AI diagnosis moments).\n\n## Expected Behavior\nPer test plan:\n- 'Step 7 (Q4) | **Not rendered** | First step of Phase E, cannot go back to Phase D'\n\nBack button should not be visible at all on Step 7.\n\n## Actual Behavior\nBack button is visible and appears clickable.\n\n## Screenshot\nSee .playwright-mcp/step7-q4-vision.png\n\n## Reference\ndocs/GROWTHOPERATOR_V2_E2E_TEST_PLAN.md lines 399, 407, 417","status":"closed","priority":2,"issue_type":"bug","assignee":"elijah","created_at":"2026-01-09T19:37:37.213274-08:00","created_by":"elijah","updated_at":"2026-01-09T21:46:17.493194-08:00","closed_at":"2026-01-09T21:46:17.493194-08:00","close_reason":"Fixed by hiding back button when previous step is AI moment"}
{"id":"mentorfy-0gm","title":"PostHog Analytics","description":"Implement user behavior tracking with PostHog to understand funnel performance, drop-off points, and conversion rates.\n\nReference: docs/workstreams/03-POSTHOG-ANALYTICS.md\n\nEvents to track:\n- flow_started\n- step_completed (with phase context, answer_text for long-form)\n- phase_completed\n- chat_opened, chat_message_sent (with phases_completed array)\n- embed_shown, booking_clicked (with source: sales_page | chat)","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-07T14:00:54.101011-08:00","created_by":"elijah","updated_at":"2026-01-07T16:23:57.845082-08:00","closed_at":"2026-01-07T16:23:57.845082-08:00","close_reason":"Closed"}
{"id":"mentorfy-0gm.1","title":"PostHog setup","description":"Install posthog-js, create PostHogProvider component, wrap app layout, create useAnalytics hook with all track functions.\n\nAcceptance:\n- PostHog initialized on app load\n- useAnalytics hook exported with: trackFlowStarted, trackStepCompleted, trackPhaseCompleted, trackChatOpened, trackChatMessage, trackEmbedShown, trackBookingClicked\n\nFiles to create:\n- src/providers/PostHogProvider.tsx\n- src/hooks/useAnalytics.ts\n\nFiles to modify:\n- src/app/layout.tsx (wrap with provider)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T14:01:21.104608-08:00","created_by":"elijah","updated_at":"2026-01-07T16:10:25.555343-08:00","closed_at":"2026-01-07T16:10:25.555343-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mentorfy-0gm.1","depends_on_id":"mentorfy-0gm","type":"parent-child","created_at":"2026-01-07T14:01:21.107433-08:00","created_by":"daemon"}]}
{"id":"mentorfy-0gm.2","title":"Instrument all events","description":"Add analytics tracking to flow components: step transitions, phase completions, chat interactions, embed displays, and booking clicks.\n\nEvents (7 total):\n1. flow_started - on new session\n2. step_completed - with step_index, phase_id, phase_name, answer_text/answer_value\n3. phase_completed - with phases_completed_so_far\n4. chat_opened - with phases_completed array, chat_version\n5. chat_message_sent - with message_index, message_length\n6. embed_shown - with source (sales_page | chat)\n7. booking_clicked - with source, step_id or chat_message_index\n\nAcceptance:\n- All 7 events firing with correct properties\n- Events visible in PostHog Live Events view\n- Phase context included on all events\n- source property distinguishes sales_page from chat\n\nReference: docs/workstreams/03-POSTHOG-ANALYTICS.md for full event schema","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T14:02:00.634056-08:00","created_by":"elijah","updated_at":"2026-01-07T16:20:42.779013-08:00","closed_at":"2026-01-07T16:20:42.779013-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mentorfy-0gm.2","depends_on_id":"mentorfy-0gm","type":"parent-child","created_at":"2026-01-07T14:02:00.639862-08:00","created_by":"daemon"},{"issue_id":"mentorfy-0gm.2","depends_on_id":"mentorfy-0gm.1","type":"blocks","created_at":"2026-01-07T14:02:48.771651-08:00","created_by":"daemon"}]}
{"id":"mentorfy-0gm.3","title":"Set up PostHog dashboards","description":"Create PostHog insights and funnels for analyzing user behavior.\n\nDashboards to create:\n1. Drop-off funnel - step_completed by step_index\n2. Phase completion funnel - phase_completed by phase_id\n3. Long-form response review - table of step_completed where answer_text is set\n4. Booking source comparison - booking_clicked breakdown by source\n5. Chat engagement - chat_message_sent avg per session, by chat_version\n\nAcceptance:\n- Can see step-by-step drop-off percentages\n- Can view actual answer_text content in table format\n- Can compare sales_page vs chat booking rates\n- Can see which chat_version (post-phase-N) has most engagement","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T14:02:27.598172-08:00","created_by":"elijah","updated_at":"2026-01-07T16:23:57.813983-08:00","closed_at":"2026-01-07T16:23:57.813983-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mentorfy-0gm.3","depends_on_id":"mentorfy-0gm","type":"parent-child","created_at":"2026-01-07T14:02:27.603088-08:00","created_by":"daemon"},{"issue_id":"mentorfy-0gm.3","depends_on_id":"mentorfy-0gm.2","type":"blocks","created_at":"2026-01-07T14:02:48.802878-08:00","created_by":"daemon"}]}
{"id":"mentorfy-0z8","title":"State Management Refactor - Server as Truth","description":"Replace optimistic sync with server-as-truth model. Fixes progress loss bug where users lose data on page refresh during debounce window. See docs/workstreams/01-STATE-MANAGEMENT.md for full plan. Blocks PostHog and Multi-Mentor workstreams.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-07T13:22:52.664288-08:00","created_by":"elijah","updated_at":"2026-01-07T13:23:16.301835-08:00","closed_at":"2026-01-07T13:23:16.301835-08:00","close_reason":"Recreating with better structure"}
{"id":"mentorfy-1g1","title":"Growth Operator Step 11: Shows wrong flow content (Rafael TATS instead of Growth Operator)","description":"## FAILED: Step 11 - Final AI Diagnosis\n\n**Expected:** \n- AI diagnosis reflecting Growth Operator test answers (self-employed, sales background, 10-20 hrs/week, $5k-$10k capital)\n- Calendly booking widget embedded inline for qualified applicant (URL: https://calendly.com/brady-mentorfy/30min)\n- Diagnosis text appears ABOVE calendar embed\n\n**Actual:**\n- Page shows Rafael TATS flow content instead:\n  - 'figuring out your booking situation'\n  - 'Charging your current rate'\n  - 'When I asked you to be honest, you said: Something real' (never entered)\n  - Bullet points about 'Getting booked without going viral', 'A 30-minute content system'\n- NO Calendly widget present\n- Diagnosis does not reflect any user answers from the Growth Operator assessment\n\n**Screenshot:** .playwright-mcp/step11-no-calendly.png\n\n**Console Errors:** None (all API calls returned 200)\n\n**Test Data Used:**\n- Situation: Self-employed or freelancing\n- Background: Sales or business development  \n- Experience: Yes, one or two attempts\n- Time: 10-20 hours\n- Capital: $5,000 - $10,000\n- Contact: Test User / test@example.com / (555) 999-8888\n- Open answers: Thoughtful qualifying responses\n\n**Root Cause Hypothesis:** Session/flow state contamination - appears to be loading cached or stale diagnosis from a different flow (Rafael TATS) instead of generating new diagnosis for Growth Operator.","status":"closed","priority":1,"issue_type":"bug","assignee":"elijah","created_at":"2026-01-09T16:13:49.894392-08:00","created_by":"elijah","updated_at":"2026-01-09T16:18:43.485523-08:00","closed_at":"2026-01-09T16:18:43.485523-08:00","close_reason":"Fixed by removing rafael-tats fallbacks in /api/generate/[type]/route.ts. Session.flow_id is now required - returns 400 error if missing instead of silently using wrong agent."}
{"id":"mentorfy-2m3","title":"Phase 3.2: Add root-level dev files","description":"Create Makefile with install/dev/web/api targets. Optionally add docker-compose.yml for local Redis/Neo4j.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-01T17:03:14.258259-08:00","created_by":"elijah","updated_at":"2026-01-01T17:36:54.25378-08:00","closed_at":"2026-01-01T17:36:54.25378-08:00","close_reason":"Closed"}
{"id":"mentorfy-2w5","title":"First AI diagnosis markdown not rendering - raw ## visible","description":"## Summary\nThe first AI diagnosis (Step 7) displays raw markdown syntax instead of properly rendered HTML.\n\n## Evidence\nScreenshot shows:\n- Raw `##` visible in text: \"success.## How the Growth Operator Model Works for You\"\n- No paragraph spacing - text runs together\n- Headers should render as `\u003ch2\u003e` elements but appear as plain text\n\n## Expected Behavior\n- `## headers` render as visually distinct section headers (larger font, bold)\n- `**bold text**` renders as bold (not showing asterisks)\n- Paragraphs have visible spacing between them (blank lines respected)\n- No raw markdown syntax visible in the rendered output\n\n## Actual Behavior\n- Raw `##` syntax visible in output\n- No visual hierarchy\n- Text runs together without paragraph breaks\n\n## Screenshot\nSee .playwright-mcp/growthoperator-step7-diagnosis.png\n\n## Notes\nThe DOM snapshot shows the content is in a single `\u003ch2\u003e` element with `\u003cstrong\u003e` tags for bold, but the `##` for subsections is not being parsed - it's included as literal text.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-09T14:04:28.848602-08:00","created_by":"elijah","updated_at":"2026-01-09T14:12:07.472002-08:00","closed_at":"2026-01-09T14:12:07.472002-08:00","close_reason":"Added normalizeMarkdown() function to ensure ## headers get proper \\n\\n separation before block splitting"}
{"id":"mentorfy-2ze","title":"Step 12: Fit Assessment AI diagnosis text missing - only Calendly widget shows","description":"## Bug Report\n\n**Location:** Growth Operator V2 Flow - Step 12 (Fit Assessment)\n\n**Expected Behavior:**\nAccording to the test plan, Step 12 should display:\n1. AI response opening with '**So now you see the opportunity.**'\n2. References to user's model, vision, and 'why now' using their actual words\n3. Stack the offer with 'What if...' questions\n4. '**Not information. Infrastructure.**'\n5. Selection frame: 'We're looking for serious Growth Operators'\n6. Personalized close: '**Based on everything you've shared, I think that's you.**'\n7. Transition text: 'Pick a time below. 30 minutes. They'll see everything we talked about...'\n8. THEN the Calendly booking widget\n\n**Actual Behavior:**\nThe Calendly widget appears immediately after clicking Continue from Step 11 (Path Reveal), with NO Fit Assessment AI diagnosis text displayed above it.\n\n**Screenshot:** .playwright-mcp/step12-fit-assessment.png\n\n**Server logs show:**\n- POST /api/generate/diagnosis 200 in 8.1s (the diagnosis API was called and returned 200)\n- But the response text is not rendered on the page\n\n**Steps to Reproduce:**\n1. Complete Growth Operator V2 flow through Step 11\n2. Click Continue on Path Reveal\n3. Observe Calendly widget appears with no diagnosis text\n\n**Impact:** High - users see booking widget without the personalized pitch/close that's supposed to convert them","status":"closed","priority":1,"issue_type":"bug","assignee":"elijah","created_at":"2026-01-09T18:56:45.22309-08:00","created_by":"elijah","updated_at":"2026-01-09T19:09:58.525704-08:00","closed_at":"2026-01-09T19:09:58.525704-08:00","close_reason":"Fixed in fix/step12-diagnosis-text branch"}
{"id":"mentorfy-37t","title":"Revisit Clerk org ID usage - currently deprecated","description":"We're passing clerk_org_id around in various places (Langfuse traces, session data) but we aren't actually doing auth right now, so these org IDs are deprecated/unused.\n\nPlaces to audit:\n- src/app/api/generate/[type]/route.ts - metadata includes orgId\n- src/app/api/chat/route.ts - metadata includes orgId\n- Session table has clerk_org_id column\n\nOnce we implement proper auth, decide whether to:\n1. Remove org ID references entirely\n2. Wire them up properly to real Clerk auth\n3. Replace with a different org/tenant model","status":"open","priority":3,"issue_type":"chore","created_at":"2026-01-09T12:45:53.696198-08:00","created_by":"elijah","updated_at":"2026-01-09T12:45:53.696198-08:00"}
{"id":"mentorfy-3c7","title":"Remove useAgent hook - replace with AI SDK hooks","description":"## Summary\nuseAgent hook in src/hooks/useAgent.ts provides minimal value over the AI SDK's built-in hooks and contains buggy stream parsing logic.\n\n## Background\nInvestigation of mentorfy-97l revealed that useAgent's custom stream parsing was stripping newlines from plain text streams. The fix was to use toUIMessageStreamResponse() everywhere, but this exposed that useAgent is largely redundant.\n\n## Current State\n- **AIChat** already uses AI SDK's `useChat` directly (not useAgent)\n- **PhaseFlow** is the only consumer of `useAgent.getResponse()`\n- The custom stream parsing (lines 141-195) reinvents what the AI SDK does automatically\n- Tool result parsing is handled natively by AI SDK's `message.parts` API\n\n## What useAgent does vs AI SDK\n\n| Feature | useAgent | AI SDK Equivalent |\n|---------|----------|-------------------|\n| Chat with messages | sendMessage() | useChat (AIChat already uses this) |\n| Session ID in requests | Auto-injects | body: { sessionId } in sendMessage |\n| Embed/tool extraction | Custom parsing | message.parts API |\n| Generation from promptKey | getResponse() | useCompletion with custom endpoint |\n\n## Recommended Changes\n1. Replace PhaseFlow's `getResponse` usage with `useCompletion` configured for `/api/generate/diagnosis`\n2. Delete `src/hooks/useAgent.ts`\n3. Standardize on AI SDK hooks throughout the codebase\n\n## Benefits\n- Less custom code to maintain\n- Leverage AI SDK's well-tested stream parsing\n- Consistent patterns across components\n- Avoid future bugs like the newline stripping issue","status":"closed","priority":1,"issue_type":"chore","assignee":"elijah","created_at":"2026-01-09T14:45:11.794733-08:00","created_by":"elijah","updated_at":"2026-01-09T15:41:50.684903-08:00","closed_at":"2026-01-09T15:41:50.684903-08:00","close_reason":"Deleted useAgent hook. Replaced with inline fetch in PhaseFlow that properly parses AI SDK UI message stream format.","labels":["tech-debt"]}
{"id":"mentorfy-3jl","title":"Growth Operator: Shows Rafael TATS content instead of Growth Operator AI diagnosis","description":"## FAILED: Step 7 - First AI Diagnosis Moment\n\n**Expected:** After completing contact form (Step 6), AI response should appear that:\n1. Addresses the user by name ('Test User')\n2. Reflects back their situation (self-employed), background (sales), experience (one or two attempts), time (10-20 hrs), and capital ($5k-10k)\n3. Explains how the Growth Operator model works for someone in their specific situation\n4. Transitions to the open-ended questions\n\n**Actual (Initial):** Page briefly showed 'Level not found' error message\n\n**Actual (After Loading):** Page displays **Rafael TATS flow content** instead of Growth Operator content:\n- Shows 'Your Tattoo Business Diagnosis' heading\n- Content about opening a tattoo studio, mentoring apprentices\n- Content about 'tattoo style', 'content creation for artists'\n- No mention of Growth Operator model, AI products, or sales partnership\n\n**Root Cause Hypothesis:** The Growth Operator flow is incorrectly using Rafael TATS AI system prompts or the flow routing is broken after the contact form step.\n\n**Test Data Used:**\n- Situation: Self-employed or freelancing\n- Background: Sales or business development  \n- Experience: Yes, one or two attempts\n- Time: 10-20 hours\n- Capital: $5,000 - $10,000\n- Name: Test User\n- Email: test@example.com\n- Phone: (555) 999-8888\n\n**Reproduction Steps:**\n1. Navigate to localhost:3000/growthoperator\n2. Clear localStorage/sessionStorage\n3. Click 'See If I Qualify'\n4. Complete all 5 MC questions\n5. Fill contact form and click Continue\n6. Observe wrong flow content\n\n**Screenshot:** .playwright-mcp/growthoperator-level-not-found.png\n\n**Impact:** Complete flow corruption - Growth Operator users see tattoo artist content, breaking the entire user experience and brand positioning.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-08T18:53:01.227119-08:00","created_by":"elijah","updated_at":"2026-01-08T19:13:46.131524-08:00","closed_at":"2026-01-08T19:13:46.131524-08:00","close_reason":"Closed"}
{"id":"mentorfy-3p0","title":"Set up agent architecture","description":"Create src/agents with: types.ts (AgentConfig, ToolConfig, ToolContext), registry.ts (getAgent, listAgents), and rafael/chat.ts with the chat agent config. Keep it minimal - just a map and typed configs.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-02T08:44:35.725657909Z","created_by":"eli","updated_at":"2026-01-02T08:53:23.406446021Z","deleted_at":"2026-01-02T08:53:23.406446021Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mentorfy-3s6","title":"Contact info form submission resets flow to Step 1","description":"During E2E testing of Rafael TATS flow:\n\n**Steps to reproduce:**\n1. Start fresh at localhost:3000\n2. Click 'Start Your Diagnosis'\n3. Complete Step 1.1 (business stage) - select 'Bookings are inconsistent'\n4. Complete Step 1.2 (day rate) - select '$1k - $2k'\n5. Complete Step 1.3 (what's stopping you) - select 'Good work but invisible'\n6. Complete Step 1.4 (contact info) - fill name/email/phone and click Continue\n\n**Expected:** Flow proceeds to Step 1.5 - Long answer question 'Be honest: why aren't you booked out yet?'\n\n**Actual:** Flow resets back to Step 1.1 - 'What stage is your tattoo business at now?' (first question)\n\nThis is a critical bug that prevents users from completing Phase 1 of the flow.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-07T17:42:31.224697-08:00","created_by":"elijah","updated_at":"2026-01-08T18:56:08.299867-08:00","closed_at":"2026-01-08T18:56:08.299867-08:00","close_reason":"Closed"}
{"id":"mentorfy-4f7","title":"Growth Operator first AI diagnosis shows Rafael TATS content","description":"## FAILED: Step 7 - First AI Diagnosis\n\n**Expected:**\n- Response should reflect Growth Operator assessment answers\n- Should address user by name (Test User)\n- Should reflect back: self-employed, sales background, 10-20 hours, $5k-$10k capital\n- Should explain how the Growth Operator model works\n\n**Actual:**\n- Heading shows 'Your Tattoo Business Diagnosis'\n- Content talks about tattoo content creation, studio dreams, marketing\n- No mention of Growth Operator model\n- User name not addressed\n- Wrong flow context entirely\n\n**Root Cause Hypothesis:**\nThe AI prompt or context being sent to the LLM is using Rafael TATS flow data instead of Growth Operator flow data.\n\n**Steps to Reproduce:**\n1. Navigate to /growthoperator\n2. Complete MC questions (any valid answers)\n3. Enter contact info and submit\n4. Observe first AI diagnosis response\n\n**Console Errors:** None observed","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-08T19:23:27.575454-08:00","created_by":"elijah","updated_at":"2026-01-08T20:53:31.837183-08:00","closed_at":"2026-01-08T20:53:31.837183-08:00","close_reason":"Closed"}
{"id":"mentorfy-4xr","title":"Enable prompt iteration through Langfuse Prompt Management","description":"Enable Brady to iterate on LLM agent prompts through Langfuse UI without code changes.\n\n## Current State\n- 11 agents defined in src/agents/ with hardcoded system prompts\n- Each agent has: id, model, systemPrompt, maxTokens, temperature, tools\n- Some prompts are dynamic (rafael-chat has getRafaelChatPrompt with embed tools)\n\n## Desired State\n- System prompts stored in Langfuse Prompt Management\n- Brady can edit prompts in Langfuse UI\n- Code fetches prompts at runtime with fallbacks to hardcoded versions\n- Generations linked to prompt versions for observability\n\n## Agents to migrate\n- rafael-chat (dynamic prompt with embed section)\n- rafael-diagnosis\n- rafael-summary\n- growthoperator-diagnosis (v1)\n- growthoperator-q2-personalize\n- growthoperator-q3-personalize\n- growthoperator-diagnosis-1\n- growthoperator-diagnosis-2\n- growthoperator-diagnosis-3\n- growthoperator-path-reveal\n- growthoperator-fit-assessment","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-09T19:24:31.599201-08:00","created_by":"elijah","updated_at":"2026-01-09T19:57:16.955125-08:00"}
{"id":"mentorfy-4xr.1","title":"Use 'prompt' field for chat messages in Langfuse generations","description":"Change `input: langfuseMessages` to `prompt: langfuseMessages` on `trace.generation()` calls.\n\nFor chat-based generations, Langfuse uses `prompt` (not `input`) to store messages that can be replayed in the playground. The `input` field is for arbitrary data.\n\n## Files to update\n\n- `src/app/api/chat/route.ts` (line ~238-246)\n- `src/app/api/generate/[type]/route.ts` (line ~191-199)\n- `src/app/api/generate/personalize-question/route.ts`\n\n## Acceptance Criteria\n\n- [ ] All `trace.generation()` calls use `prompt` instead of `input` for message arrays\n- [ ] Messages remain in OpenAI-compatible format: `[{role, content}]`","notes":"Research findings:\n\nThe issue description appears to be incorrect. After investigating:\n\n1. The prompt field in Langfuse SDK is NOT for raw messages - it expects LangfusePromptRecord | LangfusePromptClient for linking to Langfuse Prompt Management\n2. The input field IS correct for passing message arrays\n3. The playground works when messages are in OpenAI ChatML format\n\nCurrent code already uses correct format. Need to verify if playground actually works or find different root cause.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T19:24:40.015353-08:00","created_by":"elijah","updated_at":"2026-01-09T19:57:28.010926-08:00","closed_at":"2026-01-09T19:57:28.010926-08:00","close_reason":"Incorrectly scoped. prompt field is for Langfuse Prompt Management linking, not raw messages. Real solution is Langfuse Prompt Management integration.","dependencies":[{"issue_id":"mentorfy-4xr.1","depends_on_id":"mentorfy-4xr","type":"parent-child","created_at":"2026-01-09T19:24:40.017953-08:00","created_by":"elijah"}]}
{"id":"mentorfy-4xr.2","title":"Log tool definitions to Langfuse generations","description":"When tools are registered (showBooking, showCheckout, showVideo), include tool definitions in the generation so the playground can replay tool-augmented calls.\n\n## Current behavior\n\nTools are built dynamically in `buildEmbedTools()` and `buildDiagnosisTools()` but their schemas aren't sent to Langfuse.\n\n## Files to update\n\n- `src/app/api/chat/route.ts`\n- `src/app/api/generate/[type]/route.ts`\n\n## Acceptance Criteria\n\n- [ ] Tool definitions are included in generation metadata or dedicated field\n- [ ] Playground can see which tools were available for the generation","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T19:24:48.405763-08:00","created_by":"elijah","updated_at":"2026-01-09T20:00:43.757926-08:00","closed_at":"2026-01-09T20:00:43.757926-08:00","close_reason":"Not needed for prompt iteration goal. Tool logging is a separate 'nice to have' for playground replay - can revisit later if needed.","dependencies":[{"issue_id":"mentorfy-4xr.2","depends_on_id":"mentorfy-4xr","type":"parent-child","created_at":"2026-01-09T19:24:48.41211-08:00","created_by":"elijah"}]}
{"id":"mentorfy-4xr.3","title":"Verify model name compatibility with Langfuse playground","description":"Check if `claude-haiku-4-5-20251001` is recognized by Langfuse's playground. The playground needs to know which provider to use for replay.\n\n## Research needed\n\n1. Check Langfuse docs for supported Anthropic model names\n2. Test if current model IDs work in playground\n3. If not, determine if we need to map to standard names\n\n## Model IDs currently used\n\n- `claude-haiku-4-5-20251001` (most agents)\n- `gemini-2.5-flash-lite` (growthoperator-diagnosis)\n\n## Acceptance Criteria\n\n- [ ] Document which model IDs Langfuse playground supports\n- [ ] Update model names if needed, or confirm they work","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T19:24:56.297515-08:00","created_by":"elijah","updated_at":"2026-01-09T20:00:44.09338-08:00","closed_at":"2026-01-09T20:00:44.09338-08:00","close_reason":"Not needed for prompt iteration goal. Model compatibility is for playground replay, not prompt management.","dependencies":[{"issue_id":"mentorfy-4xr.3","depends_on_id":"mentorfy-4xr","type":"parent-child","created_at":"2026-01-09T19:24:56.299343-08:00","created_by":"elijah"}]}
{"id":"mentorfy-4xr.4","title":"Consider migrating to AI SDK experimental_telemetry","description":"The Vercel AI SDK (already used in this project) has built-in OpenTelemetry support via `experimental_telemetry: { isEnabled: true }`. This auto-captures everything in the correct format.\n\n## Current approach\nManual `trace.generation()` calls alongside AI SDK `streamText` calls.\n\n## Recommended approach\nEnable `experimental_telemetry` on `streamText`/`generateText` calls and let the SDK emit traces that Langfuse ingests via OpenTelemetry.\n\n## Trade-offs\n\n**Pros:**\n- Less code to maintain\n- Auto-captures correct format\n- Tool calls tracked automatically\n\n**Cons:**\n- Larger refactor\n- Need to set up OpenTelemetry exporter\n- May lose some custom metadata\n\n## Decision\n\nThis is optional - Tasks 1.1-1.3 should fix the immediate issue. Consider this for long-term maintainability.\n\n## Acceptance Criteria\n\n- [ ] Evaluate if migration is worth the effort\n- [ ] If yes, migrate all API routes to use experimental_telemetry","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-09T19:25:05.962073-08:00","created_by":"elijah","updated_at":"2026-01-09T20:00:44.422514-08:00","closed_at":"2026-01-09T20:00:44.422514-08:00","close_reason":"Out of scope for prompt iteration goal. experimental_telemetry migration is a separate optimization that doesn't enable prompt editing.","dependencies":[{"issue_id":"mentorfy-4xr.4","depends_on_id":"mentorfy-4xr","type":"parent-child","created_at":"2026-01-09T19:25:05.963813-08:00","created_by":"elijah"}]}
{"id":"mentorfy-4xr.5","title":"Add Langfuse prompt fetching with code-injected data docs","description":"Create utility to fetch prompts from Langfuse and inject code-controlled sections.\n\n## Architecture\n\n```\nfinalSystemPrompt = dataAccessDocs + langfusePrompt\n```\n\n- **dataAccessDocs** (code): What context fields exist, stays in sync with actual code\n- **langfusePrompt** (Brady): Everything else - formatting, structure, copy, tool call logic\n\n## API\n\n```typescript\nasync function getAgentPrompt(agentId: string): Promise\u003c{\n  systemPrompt: string           // Combined prompt ready for LLM\n  langfusePrompt?: ChatPromptClient  // For linking to generation\n}\u003e\n```\n\n## Features\n- Fetch chat prompts by agent ID from Langfuse\n- Caching (5 min TTL for prod)\n- Fallback to hardcoded prompts if Langfuse unavailable\n- Prepend data access docs from code\n- Return prompt object for generation linking (enables version tracking)\n\n## Data Access Docs (per agent)\nEach agent has context fields it can access. Code defines these:\n```\nYou have access to:\n- businessModelHistory.modelTried: The business model they tried\n- businessModelHistory.whatHappened: Their story\n...\n```\n\n## Files\n- src/lib/langfuse.ts (extend existing)\n- src/agents/data-docs.ts (new - defines what fields each agent can access)","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-09T19:57:48.736591-08:00","created_by":"elijah","updated_at":"2026-01-09T23:12:49.150861-08:00","dependencies":[{"issue_id":"mentorfy-4xr.5","depends_on_id":"mentorfy-4xr","type":"parent-child","created_at":"2026-01-09T19:57:48.741153-08:00","created_by":"elijah"}]}
{"id":"mentorfy-4xr.6","title":"Integrate prompt fetching into API routes","description":"Update API routes to fetch prompts from Langfuse:\n\n## Routes to update\n1. `src/app/api/chat/route.ts` - Use Langfuse prompt for system message\n2. `src/app/api/generate/[type]/route.ts` - Use Langfuse prompt for each agent\n3. `src/app/api/generate/personalize-question/route.ts` - Use Langfuse prompt\n\n## Changes needed\n- Import getAgentPrompt utility\n- Replace hardcoded agent.systemPrompt with fetched prompt\n- Pass langfusePrompt to trace.generation() for linking\n- Handle variables for dynamic prompts (rafael-chat embed section)\n\n## Dependencies\n- mentorfy-4xr.5 (prompt utility)","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-09T19:57:56.938214-08:00","created_by":"elijah","updated_at":"2026-01-09T19:58:13.130013-08:00","dependencies":[{"issue_id":"mentorfy-4xr.6","depends_on_id":"mentorfy-4xr","type":"parent-child","created_at":"2026-01-09T19:57:56.939708-08:00","created_by":"elijah"}],"await_id":"mentorfy-4xr.5"}
{"id":"mentorfy-4xr.7","title":"Create initial prompts in Langfuse","description":"Create the 11 agent prompts in Langfuse Prompt Management:\n\n## Prompts to create\nUse agent ID as prompt name, type=chat:\n\n### Rafael TATS\n- `rafael-chat` - Include `{{embedSection}}` variable for dynamic tools\n- `rafael-diagnosis`\n- `rafael-summary`\n\n### Growth Operator v1\n- `growthoperator-diagnosis`\n\n### Growth Operator v2\n- `growthoperator-q2-personalize`\n- `growthoperator-q3-personalize`\n- `growthoperator-diagnosis-1`\n- `growthoperator-diagnosis-2`\n- `growthoperator-diagnosis-3`\n- `growthoperator-path-reveal`\n- `growthoperator-fit-assessment`\n\n## Prompt structure\nEach prompt should be a chat prompt with:\n```json\n[\n  { \"role\": \"system\", \"content\": \"\u003csystem prompt content\u003e\" }\n]\n```\n\n## Labels\n- Add 'production' label to each after testing\n- Use 'staging' for iteration\n\n## Source\nCopy from src/agents/*/\\*.ts files","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T19:58:08.290147-08:00","created_by":"elijah","updated_at":"2026-01-09T19:58:08.290147-08:00","dependencies":[{"issue_id":"mentorfy-4xr.7","depends_on_id":"mentorfy-4xr","type":"parent-child","created_at":"2026-01-09T19:58:08.291527-08:00","created_by":"elijah"}]}
{"id":"mentorfy-5c9","title":"Rename Rafael-specific components in AIChat.tsx to be flow-agnostic","description":"AIChat.tsx has Rafael-specific naming (RafaelContent, RafaelMessage, StreamingRafaelMessage, EmbeddedRafaelMessage, CompletedEmbeddedMessage) that should be renamed to generic names now that the component is used across multiple flows.\n\nSuggested renames:\n- RafaelContent → FormattedContent or MarkdownContent\n- RafaelMessage → AssistantMessage\n- StreamingRafaelMessage → StreamingAssistantMessage\n- EmbeddedRafaelMessage → StreamingEmbeddedMessage\n- CompletedEmbeddedMessage → (keep or rename to StaticEmbeddedMessage)\n\nAlso:\n- The AGENT_ID constant is hardcoded to 'rafael-chat'\n- Comment says 'Hardcoded for Rafael - swap when mentor #2 comes'\n\n**Hardcoded placeholder text:**\n- AIChat.tsx:1351 passes placeholder=\"Message Rafael...\" to ChatBar\n- ChatBar.tsx:263 defaults placeholder to \"Message Rafael...\"\n- Fix: Use `getFlow(flowId).mentor.name` to set placeholder dynamically\n\nLow priority since it's purely cosmetic tech debt.","status":"open","priority":3,"issue_type":"chore","created_at":"2026-01-09T14:21:52.961704-08:00","created_by":"elijah","updated_at":"2026-01-09T14:23:26.84102-08:00","labels":["tech-debt"]}
{"id":"mentorfy-5fz","title":"Phase 1.2: Verify apps work","description":"Test web (pnpm install \u0026\u0026 pnpm build) and API (uv sync \u0026\u0026 uv run python start_server.py) to confirm they run in new locations","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-01T17:02:51.316948-08:00","created_by":"elijah","updated_at":"2026-01-01T17:03:27.543601-08:00","deleted_at":"2026-01-01T17:03:27.543601-08:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mentorfy-5g1","title":"Growth Operator: Calendly widget not appearing for qualified applicants","description":"## Summary\nIn the Growth Operator flow, when a user completes the assessment and is qualified, the Calendly booking widget should appear embedded inline with the final AI diagnosis. Currently, the widget does not appear.\n\n## Steps to Reproduce\n1. Navigate to /growthoperator\n2. Complete the assessment with qualifying answers:\n   - Time: 10-20 hours\n   - Capital: $5,000 - $10,000\n   - Thoughtful long-form answers\n3. Reach Step 11 (Final AI Diagnosis)\n\n## Expected\n- Calendly booking widget embedded inline with diagnosis\n- Widget URL: https://calendly.com/brady-mentorfy/30min\n- Diagnosis text appears ABOVE the calendar embed\n\n## Actual\n- Final diagnosis appears with qualification decision\n- NO Calendly widget - just a Continue button\n- Clicking Continue leads to 'Complete Assessment' screen\n- Then shows Rafael TATS flow content (wrong flow)\n\n## Evidence\n- Screenshot: .playwright-mcp/step11-missing-calendly.png\n- AI clearly states user is qualified: 'you seem like a strong candidate'\n- AI says 'Let'\\''s get you scheduled to discuss this further' but no booking option appears\n\n## Test Plan Reference\ndocs/GROWTHOPERATOR_E2E_TEST_PLAN.md - Step 11, Outcome A","status":"closed","priority":1,"issue_type":"bug","assignee":"elijah","created_at":"2026-01-09T14:47:20.34579-08:00","created_by":"elijah","updated_at":"2026-01-09T14:52:41.18881-08:00","closed_at":"2026-01-09T14:52:41.18881-08:00","close_reason":"Fixed: useAgent.ts was checking data.result instead of data.output for tool results. AI SDK v6 returns tool results with output field."}
{"id":"mentorfy-5lp","title":"E2E flow verification","description":"Verify the complete user flow works end-to-end before going live.\n\nTest flow:\n1. POST /api/session → get sessionId\n2. PATCH /api/session/[id] with name, email, context answers\n3. POST /api/chat with a question → verify streaming response includes context\n4. POST /api/generate/diagnosis → verify output references user's answers\n5. Check Langfuse dashboard → verify traces captured with costs\n\nSuccess criteria:\n- [ ] Anonymous user can complete full flow with real AI responses\n- [ ] Context persists across chat messages\n- [ ] Langfuse shows traces with token counts and latency\n- [ ] Response latency \u003c 3s for first token\n- [ ] Rate limiting returns 429 when exceeded\n\nDepends on: mentorfy-j52, mentorfy-fe8, mentorfy-fxe","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-02T08:58:26.725621262Z","created_by":"eli","updated_at":"2026-01-02T08:59:10.535159303Z","deleted_at":"2026-01-02T08:59:10.535159303Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mentorfy-5sw","title":"PostHog Analytics Gap Closure","description":"Fix all analytics tracking to match spec in 03-POSTHOG-ANALYTICS.md. All events must include session_id and flow_id, use snake_case properties, and include required context like phasesCompleted.","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-08T18:54:00.800549-08:00","created_by":"elijah","updated_at":"2026-01-08T18:54:00.800549-08:00"}
{"id":"mentorfy-5sw.1","title":"Rewrite useAnalytics hook","description":"Replace entire hook with new implementation from plan doc (03a-POSTHOG-FIXES.md).\n\n**File**: src/hooks/useAnalytics.ts\n\n**Acceptance criteria**:\n- Context requires both session_id and flow_id (not optional)\n- All property names are snake_case\n- baseProps spread ensures every event has session/flow\n- Timer refs for time_on_step_ms and time_in_phase_ms\n- Exports startStepTimer() and startPhaseTimer() methods\n- All tracking method signatures match the doc\n\n**BLOCKER**: All other tasks depend on this one.","status":"closed","priority":1,"issue_type":"task","assignee":"elijah","created_at":"2026-01-08T18:54:07.248442-08:00","created_by":"elijah","updated_at":"2026-01-08T18:58:37.23033-08:00","closed_at":"2026-01-08T18:58:37.23033-08:00","close_reason":"Rewrote useAnalytics hook with: required session_id/flow_id context, snake_case properties, baseProps spread on all events, timer refs for time_on_step_ms/time_in_phase_ms, startStepTimer/startPhaseTimer methods. Call site type errors are expected and will be fixed by Tasks 2-7.","dependencies":[{"issue_id":"mentorfy-5sw.1","depends_on_id":"mentorfy-5sw","type":"parent-child","created_at":"2026-01-08T18:54:07.258577-08:00","created_by":"daemon"}]}
{"id":"mentorfy-5sw.2","title":"Wire up AIChat props and analytics","description":"AIChat needs flowId and phasesCompleted props to pass proper context to analytics calls.\n\n**Files**: src/components/flow/screens/AIChat.tsx, src/app/[flowId]/page.tsx\n\n**Subtasks**:\n1. Add flowId: string and phasesCompleted: number[] to AIChatProps interface\n2. Destructure new props in component signature\n3. Update useAnalytics call: { session_id: sessionId || '', flow_id: flowId }\n4. In page.tsx, pass flowId={flow.id} and phasesCompleted={state.progress.completedPhases} to \u003cAIChat\u003e\n\n**Depends on**: Task 1 (Rewrite useAnalytics hook)","status":"closed","priority":1,"issue_type":"task","assignee":"elijah","created_at":"2026-01-08T18:54:14.077882-08:00","created_by":"elijah","updated_at":"2026-01-08T19:01:49.755278-08:00","closed_at":"2026-01-08T19:01:49.755278-08:00","close_reason":"Added flowId and phasesCompleted props to AIChatProps, updated function signature, fixed useAnalytics call in AIChat to use new { session_id, flow_id } signature, updated page.tsx to pass flowId={flow.id} and phasesCompleted={state.progress.completedPhases}","dependencies":[{"issue_id":"mentorfy-5sw.2","depends_on_id":"mentorfy-5sw","type":"parent-child","created_at":"2026-01-08T18:54:14.082232-08:00","created_by":"daemon"},{"issue_id":"mentorfy-5sw.2","depends_on_id":"mentorfy-5sw.1","type":"blocks","created_at":"2026-01-08T18:54:50.57918-08:00","created_by":"daemon"}]}
{"id":"mentorfy-5sw.3","title":"Fix chat events","description":"Update all analytics calls in AIChat to include required properties.\n\n**File**: src/components/flow/screens/AIChat.tsx\n\n**Subtasks**:\n1. trackChatMessage: add phasesCompleted, chatAfterPhase: currentPhase\n2. handleEmbedShown: add phasesCompleted\n3. handleBookingComplete: add phasesCompleted\n\n**Depends on**: Task 2 (Wire up AIChat props)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-08T18:55:02.871168-08:00","created_by":"elijah","updated_at":"2026-01-08T19:20:56.082117-08:00","closed_at":"2026-01-08T19:20:56.082117-08:00","close_reason":"All chat event props fixed as part of build fix commit","dependencies":[{"issue_id":"mentorfy-5sw.3","depends_on_id":"mentorfy-5sw","type":"parent-child","created_at":"2026-01-08T18:55:02.874074-08:00","created_by":"elijah"},{"issue_id":"mentorfy-5sw.3","depends_on_id":"mentorfy-5sw.2","type":"blocks","created_at":"2026-01-08T18:55:07.183613-08:00","created_by":"elijah"}]}
{"id":"mentorfy-5sw.4","title":"Fix page-level events","description":"Fix trackChatOpened calls and add UTM tracking to flow_started.\n\n**File**: src/app/[flowId]/page.tsx\n\n**Subtasks**:\n1. Update trackChatOpened in handleInitialLevelComplete: add chatAfterPhase: currentPhaseNumber\n2. Update trackChatOpened in handlePanelLevelComplete: add chatAfterPhase: currentPhaseNumber\n3. Parse UTM params: const params = new URLSearchParams(window.location.search)\n4. Update trackFlowStarted: pass utm_source, utm_campaign\n\n**Depends on**: Task 1 (Rewrite useAnalytics hook)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-08T18:55:13.978884-08:00","created_by":"elijah","updated_at":"2026-01-08T19:22:29.227325-08:00","closed_at":"2026-01-08T19:22:29.227325-08:00","close_reason":"Added UTM parsing and passed to trackFlowStarted","dependencies":[{"issue_id":"mentorfy-5sw.4","depends_on_id":"mentorfy-5sw","type":"parent-child","created_at":"2026-01-08T18:55:13.982925-08:00","created_by":"elijah"},{"issue_id":"mentorfy-5sw.4","depends_on_id":"mentorfy-5sw.1","type":"blocks","created_at":"2026-01-08T18:55:21.568747-08:00","created_by":"elijah"}]}
{"id":"mentorfy-5sw.5","title":"Fix step_completed tracking","description":"Update step completion with all required properties and timing.\n\n**File**: src/components/flow/screens/PhaseFlow.tsx\n\n**Subtasks**:\n1. Add getOverallStepIndex(phaseId, phaseStepIndex) helper function\n2. Add useEffect to call analytics.startStepTimer() when currentStepIndex changes\n3. Update handleAnswer to pass: stepIndex, phaseId, phaseName, phaseStepIndex, stepType, answerKey, answerValue/answerText\n\n**Depends on**: Task 1 (Rewrite useAnalytics hook)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-08T18:55:21.659703-08:00","created_by":"elijah","updated_at":"2026-01-08T19:22:29.325708-08:00","closed_at":"2026-01-08T19:22:29.325708-08:00","close_reason":"Added startStepTimer/startPhaseTimer useEffects","dependencies":[{"issue_id":"mentorfy-5sw.5","depends_on_id":"mentorfy-5sw","type":"parent-child","created_at":"2026-01-08T18:55:21.6605-08:00","created_by":"elijah"},{"issue_id":"mentorfy-5sw.5","depends_on_id":"mentorfy-5sw.1","type":"blocks","created_at":"2026-01-08T18:55:28.649099-08:00","created_by":"elijah"}]}
{"id":"mentorfy-5sw.6","title":"Add identify() on contact submission","description":"Call PostHog identify when user submits contact info in ContactInfoStepContent.\n\n**File**: src/components/flow/screens/PhaseFlow.tsx\n\n**Subtasks**:\n1. Ensure ContactInfoStepContent has access to analytics (may need to pass as prop or lift hook)\n2. After updateContact() succeeds, call analytics.identify({ email, name, phone })\n\n**Depends on**: Task 1 (Rewrite useAnalytics hook)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-08T18:55:28.721501-08:00","created_by":"elijah","updated_at":"2026-01-08T19:23:54.056529-08:00","closed_at":"2026-01-08T19:23:54.056529-08:00","close_reason":"Added identify() call in ContactInfoStepContent after updateContact","dependencies":[{"issue_id":"mentorfy-5sw.6","depends_on_id":"mentorfy-5sw","type":"parent-child","created_at":"2026-01-08T18:55:28.722306-08:00","created_by":"elijah"},{"issue_id":"mentorfy-5sw.6","depends_on_id":"mentorfy-5sw.1","type":"blocks","created_at":"2026-01-08T18:55:35.357756-08:00","created_by":"elijah"}]}
{"id":"mentorfy-5sw.7","title":"Add booking_clicked for sales page","description":"Track booking completion from sales page Calendly widget (chat version already wired).\n\n**File**: src/components/flow/screens/PhaseFlow.tsx\n\n**Subtasks**:\n1. In SalesPageStepContent, find the existing onEventScheduled handler\n2. Add analytics.trackBookingClicked({ source: 'sales_page', phasesCompleted, stepId })\n\n**Depends on**: Task 1 (Rewrite useAnalytics hook)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-08T18:55:35.433143-08:00","created_by":"elijah","updated_at":"2026-01-08T19:24:49.251595-08:00","closed_at":"2026-01-08T19:24:49.251595-08:00","close_reason":"Added trackBookingClicked in SalesPageStepContent onEventScheduled handler","dependencies":[{"issue_id":"mentorfy-5sw.7","depends_on_id":"mentorfy-5sw","type":"parent-child","created_at":"2026-01-08T18:55:35.433978-08:00","created_by":"elijah"},{"issue_id":"mentorfy-5sw.7","depends_on_id":"mentorfy-5sw.1","type":"blocks","created_at":"2026-01-08T18:55:44.360651-08:00","created_by":"elijah"}]}
{"id":"mentorfy-5sw.8","title":"Verify all events in PostHog","description":"Manual verification using PostHog Live Events.\n\n**Checklist**:\n- [ ] Every event has session_id and flow_id\n- [ ] flow_started has utm_source, utm_campaign\n- [ ] step_completed has step_id, phase_step_index, time_on_step_ms\n- [ ] chat_opened has chat_after_phase as number\n- [ ] chat_message_sent has phases_completed, chat_after_phase\n- [ ] embed_shown has phases_completed\n- [ ] booking_clicked fires for both sources\n- [ ] User identified on contact submission\n\n**Depends on**: Tasks 1-7 (all code changes)","status":"open","priority":3,"issue_type":"chore","created_at":"2026-01-08T18:55:44.451598-08:00","created_by":"elijah","updated_at":"2026-01-08T18:55:44.451598-08:00","dependencies":[{"issue_id":"mentorfy-5sw.8","depends_on_id":"mentorfy-5sw","type":"parent-child","created_at":"2026-01-08T18:55:44.452677-08:00","created_by":"elijah"},{"issue_id":"mentorfy-5sw.8","depends_on_id":"mentorfy-5sw.1","type":"blocks","created_at":"2026-01-08T18:55:49.997662-08:00","created_by":"elijah"},{"issue_id":"mentorfy-5sw.8","depends_on_id":"mentorfy-5sw.2","type":"blocks","created_at":"2026-01-08T18:55:50.10784-08:00","created_by":"elijah"},{"issue_id":"mentorfy-5sw.8","depends_on_id":"mentorfy-5sw.3","type":"blocks","created_at":"2026-01-08T18:55:50.213151-08:00","created_by":"elijah"},{"issue_id":"mentorfy-5sw.8","depends_on_id":"mentorfy-5sw.4","type":"blocks","created_at":"2026-01-08T18:55:50.338978-08:00","created_by":"elijah"},{"issue_id":"mentorfy-5sw.8","depends_on_id":"mentorfy-5sw.5","type":"blocks","created_at":"2026-01-08T18:55:50.451223-08:00","created_by":"elijah"},{"issue_id":"mentorfy-5sw.8","depends_on_id":"mentorfy-5sw.6","type":"blocks","created_at":"2026-01-08T18:55:50.5613-08:00","created_by":"elijah"},{"issue_id":"mentorfy-5sw.8","depends_on_id":"mentorfy-5sw.7","type":"blocks","created_at":"2026-01-08T18:55:50.693239-08:00","created_by":"elijah"}]}
{"id":"mentorfy-5sw.9","title":"Update PostHog Insights","description":"Update existing insights and create new ones via PostHog MCP.\n\n**Tool**: PostHog MCP (mcp__posthog__insight-update, mcp__posthog__insight-create-from-query, etc.)\n\n**Subtasks**:\n\n1. **Add flow_id filter to all insights**:\n   - XD07lsvj - User Funnel: Start to Chat\n   - sYu7ZZPa - Step Completions by Phase\n   - No9lvksu - Embed Impressions\n   - rs3NPa2b - Chat Engagement\n   - oNU5XZCl - Phases Completed\n   - 1rQE0v1v - Flow Starts Over Time\n\n2. **Update Chat Engagement (rs3NPa2b)**: Add breakdown by chat_after_phase\n\n3. **Update Embed Impressions (No9lvksu)**: Add breakdown by source (chat vs sales_page)\n\n4. **Create Booking Conversion funnel**: embed_shown (type=booking) → booking_clicked, breakdown by source\n\n5. **Create Step Drop-off funnel**: Ordered by step_index\n\n6. **Create Chat by Phase insight**: chat_message_sent broken down by chat_after_phase\n\n**Dashboard**: 996899 (Mentorfy Flow Analytics)\n\n**Depends on**: Task 8 (Verify all events)","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-08T18:56:03.689135-08:00","created_by":"elijah","updated_at":"2026-01-08T20:40:53.895824-08:00","closed_at":"2026-01-08T20:40:53.895824-08:00","close_reason":"Updated all 6 existing insights with flow_id filter/breakdown. Created 2 new insights: Booking Conversion Funnel (GHTOcfwU), Step Drop-off Analysis (uiNAsS5f). Added both to dashboard 996899.","dependencies":[{"issue_id":"mentorfy-5sw.9","depends_on_id":"mentorfy-5sw","type":"parent-child","created_at":"2026-01-08T18:56:03.69025-08:00","created_by":"elijah"},{"issue_id":"mentorfy-5sw.9","depends_on_id":"mentorfy-5sw.8","type":"blocks","created_at":"2026-01-08T18:56:07.857021-08:00","created_by":"elijah"}]}
{"id":"mentorfy-5yl","title":"Wire diagnosis generation to backend","description":"Call /api/generate/diagnosis at AI moment steps in phase flow.\n\n**Current state:**\n- PhaseFlow has `AIMomentStep` type in step definitions\n- Currently shows mock or placeholder content\n\n**Implementation:**\n1. When `AIMomentStep` reached, call:\n```typescript\nconst res = await fetch('/api/generate/diagnosis', {\n  method: 'POST',\n  body: JSON.stringify({ sessionId })\n})\nconst { content } = await res.json()\n```\n\n2. Display `content` in AI moment UI\n3. Handle loading state (~2-3 seconds generation time)\n4. Handle errors gracefully\n\n**Backend returns structured analysis:**\n- Current Position\n- Key Blockers (2-3 issues)\n- Quick Wins (immediate actions)\n- Growth Path (next milestone)\n\n**Rate limits:** 3/min anon, 10/min authenticated\n\n**Files to modify:**\n- Wherever `AIMomentStep` rendering happens (likely PhaseFlow.tsx)\n\n**Depends on:** mentorfy-yfp (session init)\n\n**Note:** Works better with context synced (mentorfy-ldg), but not strictly required - backend reads whatever context exists in session.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T21:09:48.864429075Z","created_by":"eli","updated_at":"2026-01-02T21:46:30.769537847Z","closed_at":"2026-01-02T21:46:30.769537847Z","close_reason":"Already implemented in commit 887018a - useAgent.getResponse calls /api/generate/diagnosis for AI moments"}
{"id":"mentorfy-615","title":"Fix Anthropic tool schema error: input_schema.type required","description":"## Problem\n\nWhen the chat API attempts to use tools (showBooking, showCheckout, showVideo), the Anthropic API returns a 400 error:\n\n```\nError [AI_APICallError]: tools.0.custom.input_schema.type: Field required\n```\n\nThe full error response:\n```json\n{\"type\":\"error\",\"error\":{\"type\":\"invalid_request_error\",\"message\":\"tools.0.custom.input_schema.type: Field required\"},\"request_id\":\"req_011CWtsCDBhFQUptcPjSTzyi\"}\n```\n\nThis prevents the AI from using any embed tools even when they are correctly registered.\n\n## Root Cause\n\nThe `ai` SDK's tool definition format doesn't include a top-level `type: 'object'` field that the Anthropic API now requires. When Zod schemas are converted to JSON Schema for the API, the `type` field may be missing at the root level.\n\n## Location\n\n`src/app/api/chat/route.ts` lines 21-73 - the `buildEmbedTools` function\n\n## Current Tool Definition Pattern\n\n```typescript\ntools.showBooking = {\n  description: 'Show booking calendar when user is ready to schedule a call',\n  parameters: z.object({\n    beforeText: z.string().describe('Natural lead-in text before the embed'),\n    afterText: z.string().describe('Follow-up text after the embed'),\n  }),\n  execute: async ({ beforeText, afterText }) =\u003e ({ ... }),\n}\n```\n\n## Likely Solutions (try in order)\n\n### Option 1: Upgrade SDK packages\nCheck if there's a newer version of `@ai-sdk/anthropic` or `ai` that fixes this:\n```bash\nbun update @ai-sdk/anthropic ai\n```\n\n### Option 2: Use zodToJsonSchema explicitly\nThe SDK may need explicit JSON schema conversion. Try wrapping the parameters:\n```typescript\nimport { zodToJsonSchema } from 'zod-to-json-schema'\n\n// In buildEmbedTools:\nconst schema = z.object({\n  beforeText: z.string().describe('...'),\n  afterText: z.string().describe('...'),\n})\n\ntools.showBooking = {\n  description: '...',\n  parameters: zodToJsonSchema(schema),  // Convert explicitly\n  execute: async ({ beforeText, afterText }) =\u003e ({ ... }),\n}\n```\n\n### Option 3: Use tool() helper from ai SDK\nThe `ai` SDK has a `tool()` helper that may handle schema conversion correctly:\n```typescript\nimport { tool } from 'ai'\n\ntools.showBooking = tool({\n  description: '...',\n  parameters: z.object({ ... }),\n  execute: async ({ beforeText, afterText }) =\u003e ({ ... }),\n})\n```\n\n### Option 4: Manual JSON Schema with type field\nIf all else fails, define the schema manually:\n```typescript\ntools.showBooking = {\n  description: '...',\n  parameters: {\n    type: 'object',  // \u003c-- This is what Anthropic requires\n    properties: {\n      beforeText: { type: 'string', description: '...' },\n      afterText: { type: 'string', description: '...' },\n    },\n    required: ['beforeText', 'afterText'],\n  },\n  execute: async ({ beforeText, afterText }) =\u003e ({ ... }),\n}\n```\n\n## Testing\n\n1. Start the dev server: `bun run dev`\n2. Set up a session with completedPhases including phase 4 (so booking tool is registered)\n3. Send a chat message asking to book a call\n4. Check server logs - should see the tool being called without the schema error\n5. The Calendly embed should appear in the chat\n\n## References\n\n- Anthropic tool use docs: https://docs.anthropic.com/en/docs/build-with-claude/tool-use\n- Vercel AI SDK tools: https://sdk.vercel.ai/docs/ai-sdk-core/tools-and-tool-calling\n- Related error discussions: search GitHub issues for 'input_schema.type required'","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-07T15:22:31.868762-08:00","created_by":"elijah","updated_at":"2026-01-07T16:13:45.466701-08:00","closed_at":"2026-01-07T16:13:45.466701-08:00","close_reason":"Closed"}
{"id":"mentorfy-64p","title":"Sync contact info to backend session","description":"CLOSED: Consolidated into mentorfy-ldg (sync UserContext to backend).\n\nThe contact info sync and context sync are the same PATCH call to /api/session/[id]. No need for separate issues.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-02T21:09:10.336310505Z","created_by":"eli","updated_at":"2026-01-02T21:14:00.467777574Z","closed_at":"2026-01-02T21:14:00.467787562Z"}
{"id":"mentorfy-6fs","title":"Langfuse traces not appearing","description":"Langfuse dashboard shows no traces despite code being wired up.\n\n**Observed:**\n- E2E curl tests passed (chat, diagnosis work)\n- But no traces visible in Langfuse dashboard\n\n**To investigate:**\n1. Verify LANGFUSE_* env vars are set correctly in .env.local\n2. Check if Langfuse client is initialized (lib/langfuse.ts)\n3. Verify traces are being created and flushed\n4. Check Langfuse dashboard is pointing to correct project\n5. Look for errors in server logs during API calls\n\n**Files:**\n- src/lib/langfuse.ts\n- src/app/api/chat/route.ts\n- src/app/api/generate/[type]/route.ts","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-02T21:47:46.023286893Z","created_by":"eli","updated_at":"2026-01-02T21:54:06.193707167Z","closed_at":"2026-01-02T21:54:06.193707167Z","close_reason":"Fixed: env var mismatch (LANGFUSE_BASE_URL vs LANGFUSE_HOST) + added flushLangfuse() calls"}
{"id":"mentorfy-6yn","title":"Delete mock/stub files after integration","description":"Clean up placeholder files after real integrations are verified working.\n\n**Files to delete:**\n- `src/data/rafael-ai/mockResponses.ts` - entire file\n- `src/lib/api.ts` - delete stub `sendMessage()` or whole file\n\n**Also clean up:**\n- Remove artificial `setTimeout` delays in useAgent\n- Remove `console.warn` for missing mock responses\n- Remove any `// TODO: integrate with real API` comments\n\n**Do this after:** mentorfy-88s (E2E verification) passes\n\n**Depends on:** mentorfy-p82 (chat wiring), mentorfy-88s (E2E verification)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T21:10:48.006590248Z","created_by":"eli","updated_at":"2026-01-02T21:38:03.617304325Z","closed_at":"2026-01-02T21:38:03.617304325Z","close_reason":"Implemented in commit 887018a"}
{"id":"mentorfy-744","title":"Set up environment variables","description":"Block: Must complete before any other backend work.\n\n1. Create .env.local with all required keys:\n   - SUPABASE_URL, SUPABASE_SERVICE_ROLE_KEY\n   - SUPERMEMORY_API_KEY\n   - ANTHROPIC_API_KEY\n   - LANGFUSE_PUBLIC_KEY, LANGFUSE_SECRET_KEY, LANGFUSE_HOST\n   - (Clerk already configured)\n\n2. Verify each connection:\n   - Supabase: test query\n   - Supermemory: test write/search\n   - Anthropic: test completion\n   - Langfuse: test trace\n\n3. Add .env.example with placeholder values for team reference","status":"tombstone","priority":0,"issue_type":"task","created_at":"2026-01-02T08:57:24.800707334Z","created_by":"eli","updated_at":"2026-01-02T08:59:10.513570211Z","deleted_at":"2026-01-02T08:59:10.513570211Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mentorfy-77c","title":"Final AI diagnosis shows raw SSE data instead of rendered response","description":"## Summary\nStep 11 of Growth Operator E2E test failed. The final AI diagnosis page displays raw SSE streaming data instead of the properly rendered AI response and Calendly widget.\n\n## Expected Behavior\n- AI response appears as formatted text reflecting the qualification decision\n- Calendly booking widget embedded inline with URL https://calendly.com/brady-mentorfy/30min\n- Diagnosis text appears ABOVE the calendar embed\n\n## Actual Behavior\n- Raw SSE (Server-Sent Events) streaming data displayed as plaintext\n- `data: {\"type\":\"text-delta\"...}` JSON visible instead of rendered content\n- No Calendly widget visible\n- Response is completely unreadable\n\n## Notes\n- The AI correctly determined user is qualified (showBooking tool was called with correct Calendly URL)\n- The streaming response is simply not being parsed/rendered\n- Steps 0-10 all passed; this is isolated to Step 11 (final diagnosis)\n\n## Reproduction\n1. Navigate to /growthoperator\n2. Clear localStorage\n3. Complete all MC questions with qualifying answers (10-20 hrs, $5-10k capital)\n4. Complete contact info and all long-answer questions\n5. Observe final diagnosis screen","status":"closed","priority":1,"issue_type":"bug","assignee":"elijah","created_at":"2026-01-08T22:49:09.2168-08:00","created_by":"elijah","updated_at":"2026-01-08T23:30:27.868962-08:00","closed_at":"2026-01-08T23:30:27.868962-08:00","close_reason":"Fixed SSE parsing in useAgent.ts to handle AI SDK v6 streaming format. The SDK changed from legacy '0:' prefix format to new 'data: {\"type\":\"text-delta\",...}' format. Updated parsing to handle both text-delta and tool-output-available event types.","labels":["bug"]}
{"id":"mentorfy-7d0","title":"Delete old Vite code","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T22:12:28.195161-08:00","created_by":"elijah","updated_at":"2025-12-29T23:08:46.102061-08:00","closed_at":"2025-12-29T23:08:46.102061-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mentorfy-7d0","depends_on_id":"mentorfy-06l","type":"blocks","created_at":"2025-12-29T22:12:39.217118-08:00","created_by":"daemon"}]}
{"id":"mentorfy-7kw","title":"Voice recording feature (deferred)","description":"Voice recording and transcription feature.\n\n**Reference implementation:** mentorfy-frontend repo\n\n**Tech stack:**\n- Browser native APIs (MediaRecorder, getUserMedia) - no external audio libs\n- Groq Whisper API (`whisper-large-v3` model) for transcription\n- Audio format: WebM\n\n**Flow:**\n1. User clicks mic → getUserMedia({ audio: true })\n2. MediaRecorder captures audio chunks\n3. On stop → Blob sent to /api/transcribe\n4. Backend calls Groq Whisper API\n5. Transcribed text returned to frontend\n\n**Environment:**\n- `GROQ_API_KEY` - required for Whisper API\n\n**UI:** Brady's domain (not in scope here)\n\n**Files:**\n- `src/app/api/transcribe/route.ts` - new endpoint","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-02T21:10:28.166829727Z","created_by":"eli","updated_at":"2026-01-02T16:37:31.442249-08:00","closed_at":"2026-01-03T00:23:06.784937097Z"}
{"id":"mentorfy-7kw.1","title":"Create /api/transcribe endpoint","description":"Create POST endpoint for audio transcription.\n\n**Endpoint:** POST /api/transcribe\n\n**Request:**\n- Content-Type: multipart/form-data\n- Body: audio file (webm, mp3, wav, m4a)\n\n**Response:**\n```json\n{ \"success\": true, \"transcription\": \"text here\" }\n```\n\n**Implementation:**\n1. Accept multipart/form-data with audio file\n2. Validate GROQ_API_KEY exists\n3. Forward to Groq API:\n   - URL: https://api.groq.com/openai/v1/audio/transcriptions\n   - Model: whisper-large-v3\n   - Response format: json\n4. Return transcription text\n\n**Reference:** mentorfy-frontend/app/api/transcribe/route.ts\n\n**File:** src/app/api/transcribe/route.ts","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-03T00:13:47.629817998Z","created_by":"eli","updated_at":"2026-01-03T00:22:14.319208603Z","closed_at":"2026-01-03T00:22:14.319208603Z","close_reason":"Closed","dependencies":[{"issue_id":"mentorfy-7kw.1","depends_on_id":"mentorfy-7kw","type":"parent-child","created_at":"2026-01-03T00:13:47.632264073Z","created_by":"eli"},{"issue_id":"mentorfy-7kw.1","depends_on_id":"mentorfy-7kw.2","type":"blocks","created_at":"2026-01-03T00:14:15.969719684Z","created_by":"eli"}]}
{"id":"mentorfy-7kw.2","title":"Add GROQ_API_KEY to environment","description":"Add Groq API key for Whisper transcription.\n\n**Steps:**\n1. Add GROQ_API_KEY to .env.example\n2. Add to Vercel/deployment environment\n3. Document in README if needed\n\n**Get key from:** https://console.groq.com/keys","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-03T00:13:53.414893508Z","created_by":"eli","updated_at":"2026-01-03T00:20:13.85894231Z","closed_at":"2026-01-03T00:20:13.85894231Z","close_reason":"Closed","dependencies":[{"issue_id":"mentorfy-7kw.2","depends_on_id":"mentorfy-7kw","type":"parent-child","created_at":"2026-01-03T00:13:53.424393068Z","created_by":"eli"}]}
{"id":"mentorfy-7kw.3","title":"Wire ChatBar recording to /api/transcribe","description":"Connect existing mic button to transcription endpoint.\n\n**Current state:** ChatBar.tsx has mic button with startRecording handler but no actual implementation.\n\n**Implementation (in ChatBar.tsx):**\n1. Add state: isRecording, isTranscribing, mediaRecorderRef, audioChunksRef\n2. startRecording():\n   - getUserMedia({ audio: true })\n   - Create MediaRecorder with webm format\n   - Collect chunks on dataavailable\n3. stopRecording():\n   - Stop MediaRecorder\n   - Create Blob from chunks\n   - Call transcribeAudio()\n4. transcribeAudio(blob):\n   - POST to /api/transcribe with FormData\n   - On success: insert text into input field\n   - Handle errors gracefully\n\n**Reference:** mentorfy-frontend/components/mentor-prompt-box.tsx lines 316-407\n\n**File:** src/components/rafael-ai/shared/ChatBar.tsx","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-03T00:14:03.531664917Z","created_by":"eli","updated_at":"2026-01-03T00:23:06.737224128Z","closed_at":"2026-01-03T00:23:06.737224128Z","close_reason":"Closed","dependencies":[{"issue_id":"mentorfy-7kw.3","depends_on_id":"mentorfy-7kw","type":"parent-child","created_at":"2026-01-03T00:14:03.542023744Z","created_by":"eli"},{"issue_id":"mentorfy-7kw.3","depends_on_id":"mentorfy-7kw.1","type":"blocks","created_at":"2026-01-03T00:14:15.936200128Z","created_by":"eli"}]}
{"id":"mentorfy-88s","title":"E2E integration verification","description":"Verify the complete frontend-to-backend flow works before shipping.\n\n**Test sequence:**\n1. Load app fresh (clear localStorage)\n2. Verify session created (check Network tab)\n3. Complete phase 1 form\n4. Verify PATCH sent with context (check Network tab)\n5. Enter chat, send a message\n6. Verify streaming response from Claude (not mock)\n7. Check Langfuse dashboard for trace\n8. Refresh page\n9. Verify session restored (not creating new)\n10. Verify chat history preserved\n\n**Success criteria:**\n- [ ] No mock responses anywhere in flow\n- [ ] Session persists across refresh\n- [ ] Context appears in Claude's responses\n- [ ] Langfuse shows traces with token counts\n- [ ] Rate limiting works (send 6 messages fast, see 429)\n\n**Do this after:** All P0 issues complete\n\n**Files:** None - this is manual testing","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-02T21:14:22.279232843Z","created_by":"eli","updated_at":"2026-01-02T21:45:19.944234325Z","closed_at":"2026-01-02T21:45:19.944234325Z","close_reason":"E2E verified via curl: session CRUD, chat streaming with context, rate limiting (429 on 6th), diagnosis gen all working. Langfuse needs manual dashboard check."}
{"id":"mentorfy-8vr","title":"First AI diagnosis doesn't address user by name","description":"In the Growth Operator flow, Step 7 (First AI Diagnosis) should address the user by their first name (e.g., 'Hey Test User!') but instead shows a generic greeting 'Hey there!'. The user's name was collected in Step 6 (contact info form) but is not being passed to or used by the AI diagnosis generation.\n\n**Expected:** AI response addresses user by name\n**Actual:** Response says 'Hey there!' with no personalization\n\n**Test data used:**\n- First name: Test User\n- Email: test@example.com\n- Phone: (555) 999-8888\n\n**Location:** First AI diagnosis after contact info collection (Step 7 of Growth Operator E2E test)","status":"open","priority":2,"issue_type":"bug","created_at":"2026-01-08T22:19:38.940142-08:00","created_by":"elijah","updated_at":"2026-01-08T22:19:38.940142-08:00"}
{"id":"mentorfy-8x3","title":"Growth Operator shows wrong AI diagnosis (Rafael TATS content)","description":"## Bug Description\n\nThe Growth Operator flow displays the Rafael TATS flow AI diagnosis instead of generating a personalized Growth Operator diagnosis.\n\n## Steps to Reproduce\n1. Navigate to /growthoperator\n2. Clear localStorage/sessionStorage\n3. Complete the multiple choice questions:\n   - Situation: Self-employed or freelancing\n   - Background: Sales or business development\n   - Experience: Yes, one or two attempts\n   - Time: 10-20 hours\n   - Capital: $5,000 - $10,000\n4. Enter contact info and submit\n\n## Expected\nAI diagnosis that:\n- Addresses user by name\n- Reflects their MC answers (sales background, self-employed, etc.)\n- Explains the Growth Operator model\n- Transitions to open-ended questions\n\n## Actual\n- Shows 'Your Tattoo Business Diagnosis' heading\n- Content about tattoo studios, apprentices, content creation\n- No reference to submitted answers\n- Clearly the Rafael TATS flow content, not Growth Operator\n\n## Impact\nComplete flow breakage - users see irrelevant content from wrong flow","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-08T21:02:50.815458-08:00","created_by":"elijah","updated_at":"2026-01-08T21:30:53.771529-08:00","closed_at":"2026-01-08T21:30:53.771529-08:00","close_reason":"Fixed: returning user lookup was matching sessions across different flows, causing wrong AI agent to be used"}
{"id":"mentorfy-97l","title":"PhaseFlow markdown rendering puts all content in single h2 element","description":"## Bug Description\n\nIn the Growth Operator flow (PhaseFlow.tsx), when the AI diagnosis renders markdown content, the **entire response gets wrapped in a single `\u003ch2\u003e` element** instead of properly separating headers from paragraphs.\n\n## Expected Behavior\n```html\n\u003ch2\u003eYour Growth Operator Diagnosis\u003c/h2\u003e\n\u003cp\u003eHey there! It's great to connect and learn a bit about you...\u003c/p\u003e\n\u003ch2\u003eHow the Growth Operator Model Works for You\u003c/h2\u003e\n\u003cp\u003eGiven your sales experience...\u003c/p\u003e\n```\n\n## Actual Behavior\n```html\n\u003ch2\u003eYour Growth Operator DiagnosisHey there! It's great to connect and learn a bit about you...How the Growth Operator Model Works for YouGiven your sales experience...\u003c/h2\u003e\n```\n\nAll content is jammed into a single h2 element with no separation.\n\n## Visual Evidence\nScreenshot at `.playwright-mcp/growthoperator-step7-diagnosis.png` shows:\n- No visual hierarchy between headers and body text\n- Text runs together without paragraph breaks\n- Headers are same size/weight as body text\n\n## Root Cause Investigation\nThe `normalizeMarkdown()` function was added to AIChat.tsx and PhaseFlow.tsx to fix this, but it appears PhaseFlow is using ReactMarkdown in a way that doesn't properly parse the normalized content.\n\n## Affected Component\n`src/components/flow/screens/PhaseFlow.tsx` - lines around 601-603\n\n## Steps to Reproduce\n1. Navigate to /growthoperator\n2. Complete steps 1-6 (MC questions + contact form)\n3. Observe Step 7 AI diagnosis rendering","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-09T14:26:36.23482-08:00","created_by":"elijah","updated_at":"2026-01-09T14:45:42.007429-08:00","closed_at":"2026-01-09T14:45:42.007429-08:00","close_reason":"Fixed by using toUIMessageStreamResponse() for all diagnosis calls. Root cause was useAgent's plain text stream parsing stripping newlines. Filed mentorfy-3c7 to remove useAgent entirely.","labels":["bug","flow"]}
{"id":"mentorfy-9h2","title":"Phase 1.1: Move production apps into monorepo","description":"Create apps directory and rsync frontend + API repos into apps/web and apps/api (excluding .git, node_modules, .next, __pycache__, .venv, .ruff_cache)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-01T17:03:32.956672-08:00","created_by":"elijah","updated_at":"2026-01-01T17:38:35.389863-08:00","closed_at":"2026-01-01T17:38:35.389863-08:00","close_reason":"Closed"}
{"id":"mentorfy-9jm","title":"Implement session API endpoints","description":"Build session API endpoints (JSONB only - Supermemory writes happen in chat endpoint, not here).\n\n1. POST /api/session - create session, generate supermemory_container name\n2. PATCH /api/session/[id] - update contact info, deep merge context into JSONB\n3. POST /api/session/[id]/link - set clerk_user_id on session\n\nReturning user detection: if email matches existing session for same org, return that session ID.\n\nWhy no Supermemory here: Simpler. Context only needs to be in Supermemory when chat is called. Writing on every session update adds latency for no immediate value.\n\nDepends on: mentorfy-x9b (env), mentorfy-b7h (sessions table)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T08:44:34.971310471Z","created_by":"eli","updated_at":"2026-01-02T09:52:36.122100052Z","closed_at":"2026-01-02T09:52:36.122106538Z"}
{"id":"mentorfy-9st","title":"Step 12: Missing Calendly transition text","description":"## Bug Description\n\nIn Step 12 (Fit Assessment), the Calendly widget appears correctly but the expected transition text is missing.\n\n**Expected:** \"Pick a time below. 30 minutes. They'll see everything we talked about...\"\n\n**Actual:** \"The next step is a conversation with our team to make sure we're right for each other.\"\n\n## Evidence\n- Screenshot: .playwright-mcp/step12-calendly-area.png\n- Calendly widget loads correctly with URL: https://calendly.com/brady-mentorfy/30min\n\n## Location\nThe transition text should appear between the fit assessment content and the Calendly widget.\n\n## Severity\nLow - The flow works correctly, booking is possible. Just missing the expected copy.","status":"closed","priority":3,"issue_type":"bug","assignee":"elijah","created_at":"2026-01-09T22:00:36.795146-08:00","created_by":"elijah","updated_at":"2026-01-09T22:14:57.570192-08:00","closed_at":"2026-01-09T22:14:57.570192-08:00","close_reason":"Verified fixed - transition text now appears before Calendly widget"}
{"id":"mentorfy-awj","title":"Phase 2: Port layout components (2 files)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T22:12:27.407757-08:00","created_by":"elijah","updated_at":"2025-12-29T22:31:27.593975-08:00","closed_at":"2025-12-29T22:31:27.593975-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mentorfy-awj","depends_on_id":"mentorfy-i8p","type":"blocks","created_at":"2025-12-29T22:12:38.527386-08:00","created_by":"daemon"}]}
{"id":"mentorfy-b7h","title":"Create Supabase sessions table","description":"Set up Supabase client and create sessions table.\n\n1. Create lib/db.ts with Supabase client using service role key\n2. Create sessions table with: id, clerk_user_id, clerk_org_id, email, phone, name, supermemory_container, status, context JSONB, timestamps\n3. Add indexes for email+org, clerk_user_id, and status\n4. Verify with a test query\n\nPARALLEL: Can be done simultaneously with mentorfy-p94 (Supermemory wrapper) - no dependencies between them.\n\nDepends on: mentorfy-x9b (env setup)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T08:44:34.680760532Z","created_by":"eli","updated_at":"2026-01-02T09:52:29.189560704Z","closed_at":"2026-01-02T09:52:29.189571249Z"}
{"id":"mentorfy-bg4","title":"Five roles list not numbered in Diagnosis 2 (Step 5)","description":"## Bug Description\n\nIn Step 5 (AI Diagnosis 2 - The Reframe), the five roles list should be numbered 1-5 but renders as an unnumbered list.\n\n## Expected Behavior\nPer test plan:\n- 'Use numbered list (1-5) for the five roles'\n- 'Assert numbered list renders properly (1. 2. 3. 4. 5.)'\n\nList should display:\n1. The Expert\n2. The Marketer\n3. The Salesperson\n4. The Operator\n5. The Fulfillment\n\n## Actual Behavior\nList renders without numbers - appears as indented/unnumbered bullet list.\n\n## Screenshot\nSee .playwright-mcp/step5-diagnosis2.png\n\n## Reference\ndocs/GROWTHOPERATOR_V2_E2E_TEST_PLAN.md lines 149, 153","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-09T19:37:29.154606-08:00","created_by":"elijah","updated_at":"2026-01-09T20:02:24.365784-08:00","closed_at":"2026-01-09T20:02:24.365784-08:00","close_reason":"Not a bug - unnumbered list format is acceptable. Update test plan spec instead."}
{"id":"mentorfy-bq7","title":"Wire up Langfuse tracing","description":"Create lib/langfuse.ts client wrapper. Add tracing to /api/chat and /api/generate/[type] - capture inputs, outputs, token usage, latency, session ID for correlation. Set up LANGFUSE_* env vars.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-02T08:44:36.924243733Z","created_by":"eli","updated_at":"2026-01-02T08:53:23.426636293Z","deleted_at":"2026-01-02T08:53:23.426636293Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mentorfy-bsl","title":"PostHog step naming improvements","description":"Step names in PostHog are currently meaningless (e.g., 'phase-1-step-7'). Need human-readable step keys to understand funnel drop-off.\n\n## Problem\n\nWhen viewing funnels in PostHog, step IDs like `phase-1-step-7` don't tell you what the step actually is. You have to manually count through the flow definition.\n\n## Solution\n\nAdd a `stepKey` field to each step in flow definitions, then include it in PostHog events.\n\nExample keys:\n- `q1-models-tried`\n- `q2-what-happened`\n- `diag-reframe`\n- `fit-assessment`\n\n## Acceptance Criteria\n\n- [ ] All steps have descriptive stepKey values\n- [ ] PostHog events include step_key property\n- [ ] Dashboard funnels show readable step names","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-09T19:25:14.75461-08:00","created_by":"elijah","updated_at":"2026-01-09T19:57:42.15956-08:00","closed_at":"2026-01-09T19:57:42.15956-08:00","close_reason":"All step naming improvements complete"}
{"id":"mentorfy-bsl.1","title":"Add stepKey field to FlowDefinition schema","description":"Add a required `stepKey` field to the step type in the flow schema.\n\n## File to update\n\n`src/data/flows/types.ts`\n\n## Requirements\n\n- Add `stepKey: string` to base step type (or each step variant)\n- Make it required so TypeScript enforces it on all steps\n- Keys should be kebab-case, descriptive, unique within a flow\n\n## Example keys\n\nQuestions: `q1-models-tried`, `q4-vision`, `q6-commitment`\nAI moments: `diag-model-problem`, `path-reveal`, `fit-assessment`\nSales pages: `sales-calendly`\n\n## Acceptance Criteria\n\n- [ ] stepKey field added to types\n- [ ] TypeScript errors if stepKey is missing from any step","status":"closed","priority":2,"issue_type":"task","assignee":"elijah","created_at":"2026-01-09T19:25:23.604492-08:00","created_by":"elijah","updated_at":"2026-01-09T19:45:22.743451-08:00","closed_at":"2026-01-09T19:45:22.743451-08:00","close_reason":"Added required stepKey: string to StepConfig in types.ts","dependencies":[{"issue_id":"mentorfy-bsl.1","depends_on_id":"mentorfy-bsl","type":"parent-child","created_at":"2026-01-09T19:25:23.609045-08:00","created_by":"elijah"}]}
{"id":"mentorfy-bsl.2","title":"Add stepKey values to growthoperator flow","description":"Add stepKey to all steps in the growthoperator flow definition.\n\n## File to update\n\n`src/data/flows/growthoperator.ts`\n\n## Steps to update (~13 steps)\n\nPhase 1 - Assessment:\n1. `q1-models-tried` - What business models have you tried?\n2. `q2-what-happened` - Tell me what happened\n3. `q3-why-failed` - Why didn't it work?\n4. `diag-model-problem` - Diagnosis 1: Problem with that specific model\n5. `diag-reframe` - Diagnosis 2: The reframe (bigger pattern)\n6. `diag-future-pace` - Diagnosis 3: Setup for path + future pace\n7. `q4-vision` - What would change in your life?\n8. `q5-why-now` - Why today?\n9. `q6-commitment` - Are you ready for that?\n10. `q7-capital` - How much to invest?\n11. `path-reveal` - The opportunity explained\n12. `fit-assessment` - Stack the offer + conditional booking\n\n## Acceptance Criteria\n\n- [ ] All steps have stepKey values\n- [ ] Keys are descriptive and unique\n- [ ] TypeScript compiles without errors","status":"closed","priority":2,"issue_type":"task","assignee":"elijah","created_at":"2026-01-09T19:25:33.419251-08:00","created_by":"elijah","updated_at":"2026-01-09T19:49:27.288875-08:00","closed_at":"2026-01-09T19:49:27.288875-08:00","close_reason":"Added stepKey to all 12 steps","dependencies":[{"issue_id":"mentorfy-bsl.2","depends_on_id":"mentorfy-bsl","type":"parent-child","created_at":"2026-01-09T19:25:33.420774-08:00","created_by":"elijah"},{"issue_id":"mentorfy-bsl.2","depends_on_id":"mentorfy-bsl.1","type":"blocks","created_at":"2026-01-09T19:25:33.422642-08:00","created_by":"elijah"}]}
{"id":"mentorfy-bsl.3","title":"Add stepKey values to rafael-tats flow","description":"Add stepKey to all steps in the rafael-tats flow definition.\n\n## File to update\n\n`src/data/flows/rafael-tats.ts`\n\n## Steps to update (~21 steps across 4 phases)\n\n**Phase 1 - The Diagnosis (6 steps):**\n- `q1-booking-status`, `q2-day-rate`, `q3-blocker`, `q4-contact-info`, `q5-confession`, `ai-phase1-relief`\n\n**Phase 2 - Get Booked Without Going Viral (5 steps):**\n- `q6-check-first`, `q7-hundred-k`, `q8-post-worked`, `q9-views-reflection`, `ai-phase2-relief`\n\n**Phase 3 - The 30-Minute Content System (5 steps):**\n- `q10-time-on-content`, `q11-hardest-part`, `q12-creator-identity`, `q13-extra-time`, `ai-phase3-relief`\n\n**Phase 4 - Double Your Revenue (6 steps):**\n- `q14-last-price-raise`, `q15-too-expensive`, `q16-pricing-fear`, `q17-double-revenue`, `ai-phase4-relief`, `sales-calendly`\n\n## Acceptance Criteria\n\n- [ ] All 21 steps have stepKey values\n- [ ] Keys follow consistent naming pattern\n- [ ] TypeScript compiles without errors","status":"closed","priority":2,"issue_type":"task","assignee":"elijah","created_at":"2026-01-09T19:25:42.472455-08:00","created_by":"elijah","updated_at":"2026-01-09T19:51:18.177238-08:00","closed_at":"2026-01-09T19:51:18.177238-08:00","close_reason":"Added stepKey to all 21 steps across 4 phases","dependencies":[{"issue_id":"mentorfy-bsl.3","depends_on_id":"mentorfy-bsl","type":"parent-child","created_at":"2026-01-09T19:25:42.474056-08:00","created_by":"elijah"},{"issue_id":"mentorfy-bsl.3","depends_on_id":"mentorfy-bsl.1","type":"blocks","created_at":"2026-01-09T19:25:42.475888-08:00","created_by":"elijah"}]}
{"id":"mentorfy-bsl.4","title":"Send step_key in PostHog analytics events","description":"Update analytics to include the new stepKey in PostHog events.\n\n## Files to update\n\n1. `src/hooks/useAnalytics.ts`\n   - Add `stepKey: string` to `trackStepCompleted` params\n   - Include `step_key` property in the event\n\n2. `src/components/flow/screens/PhaseFlow.tsx` (or wherever trackStepCompleted is called)\n   - Pass `stepKey` from the current step definition\n\n## Event schema change\n\n```typescript\nposthog?.capture('step_completed', {\n  ...baseProps,\n  step_id: `phase-${props.phaseId}-step-${props.phaseStepIndex}`,\n  step_key: props.stepKey,  // NEW\n  step_type: props.stepType,\n  // ... rest\n})\n```\n\n## Acceptance Criteria\n\n- [ ] step_key property appears in PostHog step_completed events\n- [ ] All step completions include the correct stepKey\n- [ ] Backwards compatible (old events without step_key still work)","status":"closed","priority":2,"issue_type":"task","assignee":"elijah","created_at":"2026-01-09T19:28:20.401083-08:00","created_by":"elijah","updated_at":"2026-01-09T19:52:54.922697-08:00","closed_at":"2026-01-09T19:52:54.922697-08:00","close_reason":"Added step_key to PostHog step_completed events","dependencies":[{"issue_id":"mentorfy-bsl.4","depends_on_id":"mentorfy-bsl","type":"parent-child","created_at":"2026-01-09T19:28:20.409442-08:00","created_by":"elijah"},{"issue_id":"mentorfy-bsl.4","depends_on_id":"mentorfy-bsl.2","type":"blocks","created_at":"2026-01-09T19:28:20.412442-08:00","created_by":"elijah"},{"issue_id":"mentorfy-bsl.4","depends_on_id":"mentorfy-bsl.3","type":"blocks","created_at":"2026-01-09T19:28:20.41469-08:00","created_by":"elijah"}]}
{"id":"mentorfy-bsl.5","title":"Update PostHog dashboard funnels to use step_key","description":"Update PostHog dashboard funnel breakdowns to use `step_key` instead of `step_id`.\n\n## Manual task in PostHog UI\n\n1. Go to PostHog dashboard\n2. Edit funnel insights that break down by step\n3. Change breakdown property from `step_id` to `step_key`\n4. Verify funnels show readable step names\n\n## Notes\n\n- Old data will still have `step_id` only\n- New data will have both `step_id` and `step_key`\n- Consider keeping `step_id` as fallback for historical data\n\n## Acceptance Criteria\n\n- [ ] Funnels show readable step names (e.g., 'q6-commitment' instead of 'phase-1-step-8')\n- [ ] Can identify drop-off points without referencing flow definition code","status":"closed","priority":2,"issue_type":"chore","assignee":"elijah","created_at":"2026-01-09T19:28:28.628216-08:00","created_by":"elijah","updated_at":"2026-01-09T19:57:37.369486-08:00","closed_at":"2026-01-09T19:57:37.369486-08:00","close_reason":"Updated Step Drop-off Analysis insight to use step_key breakdown","dependencies":[{"issue_id":"mentorfy-bsl.5","depends_on_id":"mentorfy-bsl","type":"parent-child","created_at":"2026-01-09T19:28:28.631224-08:00","created_by":"elijah"},{"issue_id":"mentorfy-bsl.5","depends_on_id":"mentorfy-bsl.4","type":"blocks","created_at":"2026-01-09T19:28:28.633139-08:00","created_by":"elijah"}]}
{"id":"mentorfy-c5q","title":"Phase 0: Next.js scaffold + deps","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T22:12:26.619974-08:00","created_by":"elijah","updated_at":"2025-12-29T22:20:05.300384-08:00","closed_at":"2025-12-29T22:20:05.300384-08:00","close_reason":"Closed"}
{"id":"mentorfy-cdr","title":"Phase 1: Foundation files (CSS, data, context, hooks, lib)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T22:12:26.897566-08:00","created_by":"elijah","updated_at":"2025-12-29T22:24:02.700204-08:00","closed_at":"2025-12-29T22:24:02.700204-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mentorfy-cdr","depends_on_id":"mentorfy-c5q","type":"blocks","created_at":"2025-12-29T22:12:38.067809-08:00","created_by":"daemon"}]}
{"id":"mentorfy-cmz","title":"Session update fails with duplicate email constraint (500 error)","description":"During E2E testing of the Growth Operator flow, submitting the contact info form with email test@example.com causes a 500 error:\n\n```\nSession update error: {\n  code: '23505',\n  details: 'Key (email, clerk_org_id)=(test@example.com, org_35wDDMLUgC1nZZLkDLtZ3A8TbJY) already exists.',\n  hint: null,\n  message: 'duplicate key value violates unique constraint \"sessions_email_org_unique\"'\n}\nPATCH /api/session/... 500\n```\n\nThe flow appears to continue despite the error, but this is a bug that should be handled gracefully - either by upsert logic or by detecting returning users.\n\nSteps to reproduce:\n1. Complete Growth Operator flow with email test@example.com\n2. Clear localStorage and try again with same email\n3. Observe 500 error in server logs","status":"closed","priority":1,"issue_type":"bug","assignee":"elijah","created_at":"2026-01-08T21:53:05.425711-08:00","created_by":"elijah","updated_at":"2026-01-08T22:01:51.363668-08:00","closed_at":"2026-01-08T22:01:51.363668-08:00","close_reason":"Fixed: Updated database constraint to include flow_id, matching the code's returning user check. Old constraint was on (email, clerk_org_id) only, but the code checked (email, clerk_org_id, flow_id). Migration applied: sessions_email_org_unique -\u003e sessions_email_org_flow_unique"}
{"id":"mentorfy-cod","title":"Flow skips all questions and jumps to Path Reveal on fresh start","description":"**Environment:** Production (https://mentorfy.ai/growthoperator)\n\n**Steps to Reproduce:**\n1. Navigate to https://mentorfy.ai/growthoperator\n2. Click 'Start Conversation' button\n\n**Expected:** Q1 - Business Model Selection screen with 9 multiple choice options\n**Actual:** Flow jumps directly to 'The Path Reveal' (Step 11), skipping all 7 questions\n\n**Additional Issues Found:**\n- Content references user answers that were never given (e.g., 'five years building other people's dreams', 'sales and operations')\n- Broken markdown at bottom of page: raw asterisks visible in text\n\n**Screenshot:** .playwright-mcp/bug1-skipped-questions.png\n\n**Severity:** Critical - users cannot complete the assessment flow","status":"open","priority":0,"issue_type":"bug","created_at":"2026-01-09T22:41:36.945871-08:00","created_by":"elijah","updated_at":"2026-01-09T22:41:36.945871-08:00","labels":["bug"]}
{"id":"mentorfy-dof","title":"Flow stuck after Phase 1 - cannot progress to Phase 2","description":"After completing Phase 1 (Diagnosis), there's no way to progress to Phase 2.\n\n**Steps to Reproduce:**\n1. Start fresh session at localhost:3000\n2. Complete all Phase 1 steps (business stage, day rate, blockers, contact info, long answer)\n3. View AI diagnosis and click Continue\n4. Phase 1 completion modal appears briefly\n5. UI returns to chat + diagnosis view\n6. Clicking 'Continue' button on diagnosis just shows completion modal again\n7. No Phase 2 questions ever appear\n\n**Expected:** After Phase 1 completion, Phase 2 questions should appear (e.g., 'What do you check first after posting?')\n\n**Actual:** Flow is stuck showing Phase 1 diagnosis. Server shows completedPhases: [1] but Phase 2 never loads.\n\n**Server logs show:**\n- Multiple POST /api/flow/step 200 calls\n- completedPhases: [1] in chat tool registration\n- No errors in stderr","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-07T17:34:36.851799-08:00","created_by":"elijah","updated_at":"2026-01-08T18:55:52.502979-08:00","closed_at":"2026-01-08T18:55:52.502979-08:00","close_reason":"Closed"}
{"id":"mentorfy-dra","title":"E2E backend verification","description":"Before frontend handoff, verify full flow works:\n\n1. Create session (curl POST /api/session)\n2. Update session with context (curl PATCH /api/session/[id])\n3. Chat with Rafael, verify context retrieval (curl POST /api/chat)\n4. Generate diagnosis (curl POST /api/generate/diagnosis)\n5. Verify Langfuse traces appear\n6. Verify Supermemory memories exist\n\nDocument curl commands for frontend team.\n\nDepends on: all implementation issues","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T08:52:59.568862566Z","created_by":"eli","updated_at":"2026-01-02T09:52:51.474332509Z","closed_at":"2026-01-02T09:52:51.474338803Z"}
{"id":"mentorfy-edd","title":"Gemini model gemini-2.5-flash-lite-preview-06-17 no longer available","description":"## Summary\nThe Growth Operator flow fails at Step 7 (First AI Diagnosis) because the Gemini model being used has been deprecated or removed.\n\n## Error\n```\nError [AI_APICallError]: models/gemini-2.5-flash-lite-preview-06-17 is not found for API version v1beta, or is not supported for generateContent.\n```\n\n## Steps to Reproduce\n1. Navigate to /growthoperator\n2. Complete Steps 1-6 (MC questions + contact form)\n3. Submit contact info form\n4. Observe server logs - API returns 404\n\n## Expected Behavior\nAI diagnosis should generate and display to user\n\n## Actual Behavior\nPage shows blinking cursor with no content. Server returns 404 from Gemini API.\n\n## Screenshot\nSee .playwright-mcp/growthoperator-step7-failure.png\n\n## Impact\nCritical - blocks entire Growth Operator flow at first AI diagnosis step\n\n## Suggested Fix\nUpdate the model identifier to a currently available Gemini model (e.g., gemini-1.5-flash or gemini-2.0-flash)","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-09T13:59:09.849242-08:00","created_by":"elijah","updated_at":"2026-01-09T14:00:54.050213-08:00","closed_at":"2026-01-09T14:00:54.050213-08:00","close_reason":"Updated model from gemini-2.5-flash-lite-preview-06-17 to gemini-2.5-flash-lite"}
{"id":"mentorfy-fe8","title":"Implement generation agents and endpoint","description":"Build generation endpoints for diagnosis and summary.\n\n1. Create src/agents/rafael/diagnosis.ts agent config\n2. Create src/agents/rafael/summary.ts agent config  \n3. Implement POST /api/generate/[type] endpoint\n4. Read context from session JSONB (not Supermemory - needs instant data)\n5. Add Langfuse tracing (reuse lib/langfuse.ts from chat issue)\n6. Test: generate diagnosis and summary, verify traces\n\nDepends on: mentorfy-x9b (env), mentorfy-b7h (sessions table), mentorfy-9jm (session endpoints), mentorfy-j52 (agent architecture + Langfuse setup)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T08:44:36.478033107Z","created_by":"eli","updated_at":"2026-01-02T09:52:36.168598312Z","closed_at":"2026-01-02T09:52:36.168604951Z"}
{"id":"mentorfy-fqz","title":"Phase 2.2: Fix imports in copied files","description":"Rename context files if they conflict with existing ones. Run pnpm build to catch any issues.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-01T17:03:04.303608-08:00","created_by":"elijah","updated_at":"2026-01-01T17:32:38.245597-08:00","closed_at":"2026-01-01T17:32:38.245597-08:00","close_reason":"Closed"}
{"id":"mentorfy-fxe","title":"Add Upstash rate limiting","description":"Ship WITH MVP, not after. Cost risk is real - unprotected LLM endpoints can burn $200+ from 10K malicious requests.\n\nImplementation (~20 lines):\n1. pnpm add @upstash/ratelimit @upstash/redis\n2. Create lib/ratelimit.ts with Upstash client\n3. Add middleware to /api/chat: 5/min anon, 20/min authenticated\n4. Add middleware to /api/generate: 3/min anon, 10/min authenticated\n5. Identifier: Clerk user ID if auth'd, else IP\n6. Return 429 with Retry-After header when limited\n\nEnv vars: UPSTASH_REDIS_REST_URL, UPSTASH_REDIS_REST_TOKEN\n\nSee docs/SECURITY_RATE_LIMITING_PLAN.md for full context.\n\nDepends on: mentorfy-j52 (chat endpoint), mentorfy-fe8 (generate endpoint)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T08:44:37.320794592Z","created_by":"eli","updated_at":"2026-01-02T09:52:36.190170211Z","closed_at":"2026-01-02T09:52:36.190177617Z"}
{"id":"mentorfy-gps","title":"Chat API uses hardcoded 'rafael-ai' flow ID instead of actual flow ID","description":"When sending a chat message, the /api/chat endpoint fails with 500 error.\n\n**Error:**\n```\nChat error: Error: Flow not found: rafael-ai\n    at getFlow (src/data/flows/index.ts:10:19)\n    at sessionData (src/app/api/chat/route.ts:166:25)\n```\n\n**Steps to Reproduce:**\n1. Navigate to http://localhost:3000 (redirects to /rafael-tats)\n2. Complete Phase 1 of the flow\n3. In the chat interface, send any message (e.g., 'book me')\n4. Observe 500 error\n\n**Expected:** Chat should work with the actual flow ID (rafael-tats)\n**Actual:** Chat API tries to load 'rafael-ai' which doesn't exist\n\n**Location:** src/app/api/chat/route.ts:166","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-07T17:07:21.597261-08:00","created_by":"elijah","updated_at":"2026-01-07T17:13:11.079588-08:00","closed_at":"2026-01-07T17:13:11.079588-08:00","close_reason":"Closed"}
{"id":"mentorfy-i8p","title":"Phase 2: Port shared components (14 files)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T22:12:27.152224-08:00","created_by":"elijah","updated_at":"2025-12-29T22:30:49.881672-08:00","closed_at":"2025-12-29T22:30:49.881672-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mentorfy-i8p","depends_on_id":"mentorfy-cdr","type":"blocks","created_at":"2025-12-29T22:12:38.297869-08:00","created_by":"daemon"}]}
{"id":"mentorfy-iep","title":"Phase 2.3: Wire rafael-ai to real APIs","description":"Replace mock/stub code: use Clerk useUser() for auth, point to real streaming endpoint, use Supabase patterns from existing app. Delete src/lib/api.ts mocks.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-01T17:03:04.54149-08:00","created_by":"elijah","updated_at":"2026-01-01T17:07:18.586076-08:00","deleted_at":"2026-01-01T17:07:18.586076-08:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mentorfy-ikg","title":"Refactor context-sanitizer to be flow-agnostic","description":"## Problem\n\n`sanitizeContextForAI()` in `src/lib/context-sanitizer.ts` hardcodes transformation logic for each flow (rafael-tats, growthoperator). With 2 flows this is fine, but **becomes unwieldy when scaling to many flows**.\n\nEach new flow requires:\n1. Adding input types to `SessionContext`\n2. Adding output types to `SanitizedContext`\n3. Adding a new transformation block in the function\n\n## Proposed Solution\n\nMove context mapping into each flow's definition:\n\n```typescript\n// In flow definition\nexport const someFlow: FlowDefinition = {\n  contextMapping: {\n    'assessment.situation': 'applicantProfile.currentSituation',\n    'assessment.background': 'applicantProfile.professionalBackground',\n    // ...\n  }\n}\n```\n\nThen make `sanitizeContextForAI(flowId, context)` generic - it looks up the flow's mapping and applies it dynamically.\n\n## Benefits\n- Each flow owns its transformation rules\n- Sanitizer stays small and generic\n- Adding a flow = just add `contextMapping` to its definition\n\n## When to do this\nNot urgent with 2 flows. Tackle when adding a 3rd+ flow or during a refactor pass.","status":"open","priority":4,"issue_type":"chore","created_at":"2026-01-09T12:23:31.042467-08:00","created_by":"elijah","updated_at":"2026-01-09T12:23:31.042467-08:00","labels":["architecture","tech-debt"]}
{"id":"mentorfy-j52","title":"Implement /api/chat endpoint","description":"Build the complete chat flow including agent architecture and observability.\n\n1. Create src/agents/types.ts (AgentConfig, ToolConfig, ToolContext)\n2. Create src/agents/registry.ts (getAgent, listAgents)\n3. Create src/agents/rafael/chat.ts - extend existing src/lib/api.ts prompt\n4. Create lib/langfuse.ts client wrapper\n5. Implement POST /api/chat with SSE streaming (Vercel AI SDK)\n6. Flow: fetch session → search Supermemory → load agent → call Claude → stream response\n7. On first chat: write session context to Supermemory (fire-and-forget)\n8. After each turn: write conversation to Supermemory (fire-and-forget)\n9. Add Langfuse tracing to capture inputs, outputs, tokens, latency\n\nDepends on: mentorfy-x9b (env), mentorfy-b7h (sessions table), mentorfy-9jm (session endpoints), mentorfy-p94 (Supermemory wrapper)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T08:44:36.066351604Z","created_by":"eli","updated_at":"2026-01-02T09:52:36.145804449Z","closed_at":"2026-01-02T09:52:36.145811032Z"}
{"id":"mentorfy-k5u","title":"Phase 3.3: Consolidate config","description":"Merge or organize .env.example files. Update root .gitignore to include apps/*/node_modules, apps/*/.next, etc.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-01T17:03:14.504934-08:00","created_by":"elijah","updated_at":"2026-01-01T17:38:20.881291-08:00","closed_at":"2026-01-01T17:38:20.881291-08:00","close_reason":"Closed"}
{"id":"mentorfy-kjf","title":"Back button visible on AI diagnosis moments (should not render)","description":"## Bug Description\n\nDuring E2E testing of Growth Operator V2 flow, the back button is rendered (grayed out) on AI diagnosis steps where it should NOT be rendered at all.\n\n## Affected Steps\n- Step 4: Diagnosis 1\n- Step 5: Diagnosis 2\n- Step 6: Diagnosis 3\n- Step 11: Path Reveal\n- Step 12: Fit Assessment\n\n## Expected Behavior\nPer test plan: 'Back button NOT rendered during AI moments'\n\nThe back button should not be visible/rendered at all during AI response phases.\n\n## Actual Behavior\nBack button is rendered but appears grayed out/disabled.\n\n## Screenshot\nSee .playwright-mcp/step4-diagnosis1.png\n\n## Reference\ndocs/GROWTHOPERATOR_V2_E2E_TEST_PLAN.md lines 404-424","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-09T19:37:20.948586-08:00","created_by":"elijah","updated_at":"2026-01-09T19:52:53.67923-08:00","closed_at":"2026-01-09T19:52:53.67923-08:00","close_reason":"Fixed by hiding back button during AI moments instead of dimming"}
{"id":"mentorfy-ldg","title":"Sync UserContext state to backend session","description":"Sync UserContext state to backend session on phase completion.\n\n**Consolidates:** This issue covers both context sync AND contact info sync (mentorfy-64p closed as duplicate).\n\n**Current state:**\n- UserContext stores all data in localStorage only\n- Backend session never updated after creation\n- Data lost if user switches device\n\n**Gap found:** UserContext has `user.name` and `user.phone` but NOT `user.email`. The form collects email (phases.ts:54) but it's stored elsewhere or lost. Need to add `email` to user state.\n\n**Implementation:**\n1. Add `email` field to UserContext `user` object\n2. Add `syncToBackend()` function:\n```typescript\nasync function syncToBackend() {\n  await fetch(`/api/session/${sessionId}`, {\n    method: 'PATCH',\n    body: JSON.stringify({\n      name: state.user.name,\n      email: state.user.email,\n      phone: state.user.phone,\n      context: {\n        situation: state.situation,\n        phase2: state.phase2,\n        phase3: state.phase3,\n        phase4: state.phase4,\n        progress: state.progress,\n      }\n    })\n  })\n}\n```\n\n3. Call sync at these points:\n   - After contact info form submitted\n   - After each phase completed\n   - Debounce to avoid excessive calls (300ms)\n\n4. Handle returning user response:\n   - If PATCH returns `{ returning: true, existingSessionId }`\n   - Trigger returning user flow (separate issue mentorfy-03m)\n\n**Files to modify:**\n- `src/context/UserContext.tsx` - add email field, add sync function\n- Phase completion handlers - call sync\n\n**Depends on:** mentorfy-yfp (session init)","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-02T21:09:01.536420579Z","created_by":"eli","updated_at":"2026-01-02T21:38:02.796765524Z","closed_at":"2026-01-02T21:38:02.796765524Z","close_reason":"Implemented in commit 887018a"}
{"id":"mentorfy-min","title":"Step 12 Calendly transition text differs from test plan spec","description":"## Bug Description\n\nThe transition text before the Calendly widget in Step 12 (Fit Assessment) differs from what the test plan specifies.\n\n## Expected Behavior\nPer test plan:\n'Transition text appears: \"Pick a time below. 30 minutes. They'll see everything we talked about...\"'\n\n## Actual Behavior\nText displayed: 'The next step is a conversation with our team to make sure we're right for each other.'\n\n## Notes\n- Calendly widget IS loading correctly (URL contains brady-mentorfy/30min)\n- This may be an intentional copy change - confirm with product owner\n\n## Screenshot\nSee .playwright-mcp/step12-fit-assessment.png\n\n## Reference\ndocs/GROWTHOPERATOR_V2_E2E_TEST_PLAN.md lines 316-318","status":"closed","priority":3,"issue_type":"bug","created_at":"2026-01-09T19:37:46.208447-08:00","created_by":"elijah","updated_at":"2026-01-09T21:33:09.432948-08:00","closed_at":"2026-01-09T21:33:09.432948-08:00","close_reason":"Fixed by hardcoding afterText in showBooking tool response (src/app/api/generate/[type]/route.ts). The CTA copy after Calendly widget is now deterministic instead of AI-generated."}
{"id":"mentorfy-mv6","title":"Remove DEMO_COMMANDS from chat","description":"Delete hardcoded demo command triggers from production chat.\n\n**Current state:**\n- `src/components/rafael-ai/screens/AIChat.tsx` lines 541-594\n- Three magic strings trigger hardcoded responses:\n  - `\"sell me\"` → checkout embed with hardcoded plan ID\n  - `\"video\"` → video embed with hardcoded URL\n  - `\"book me\"` → Calendly embed with hardcoded URL\n\n**Changes needed:**\n1. Delete the `DEMO_COMMANDS` object entirely (~50 lines)\n2. Remove the demo command check logic that uses it\n3. Let all messages flow through normal AI chat path\n\n**Alternative:** If these embeds should be AI-triggered, that's a separate feature. For now, just remove the hardcoded demo triggers.\n\n**Files to modify:**\n- `src/components/rafael-ai/screens/AIChat.tsx`","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T21:09:28.923890145Z","created_by":"eli","updated_at":"2026-01-02T21:38:03.230672284Z","closed_at":"2026-01-02T21:38:03.230672284Z","close_reason":"Implemented in commit 887018a"}
{"id":"mentorfy-nbp","title":"Update video URLs in mentor config","description":"Replace placeholder video URLs with actual unique videos per phase.\n\n**Current state:**\n- `src/data/rafael-ai/mentor.ts` line 1: single `VIDEO_URL` constant\n- Lines 17-63: All 9 video entries reference same URL `4i06zkj7fg`\n- Users see same video for every phase\n\n**Changes needed:**\n1. Get actual Wistia video IDs for each phase from Rafael/content team\n2. Update each video entry in `mentor.ts` with correct URL:\n   - welcome video\n   - phase 1-4 intro videos\n   - phase 1-4 completion videos\n\n**This is a content task, not a code task.** No backend changes needed.\n\n**Files to modify:**\n- `src/data/rafael-ai/mentor.ts`\n\n**Blocked by:** Need actual video content/URLs from stakeholder","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T21:09:19.045485171Z","created_by":"eli","updated_at":"2026-01-02T21:56:39.694882371Z","closed_at":"2026-01-02T21:56:39.694882371Z","close_reason":"Blocked on content - need actual Wistia video IDs from Rafael. Reopen when content arrives."}
{"id":"mentorfy-nj2","title":"Update deployment configs","description":"Vercel: set root directory to apps/web. Railway: set root directory to apps/api.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-01T17:03:18.649302-08:00","created_by":"elijah","updated_at":"2026-01-01T17:38:26.025989-08:00","closed_at":"2026-01-01T17:38:26.025989-08:00","close_reason":"Closed"}
{"id":"mentorfy-nv0","title":"Phase 2: Port screen components (7 files)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-29T22:12:27.659857-08:00","created_by":"elijah","updated_at":"2025-12-29T22:52:38.848203-08:00","closed_at":"2025-12-29T22:52:38.848203-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mentorfy-nv0","depends_on_id":"mentorfy-awj","type":"blocks","created_at":"2025-12-29T22:12:38.758304-08:00","created_by":"daemon"}]}
{"id":"mentorfy-o3i","title":"Add onBookingComplete callback to chat booking embed","description":"Currently booking_clicked analytics can only be tracked in SalesPageStepContent because it has direct access to the Calendly useCalendlyEventListener hook.\n\nFor chat-based bookings (when the AI shows a booking embed), we have no way to track when a booking is completed because:\n1. ChatBookingEmbed renders an InlineWidget but doesn't expose an onEventScheduled callback\n2. The RenderEmbed component that wraps it has no way to bubble up booking completion events\n\n**Solution:**\n- Add an optional onBookingComplete prop to ChatBookingEmbed\n- Wire up useCalendlyEventListener inside ChatBookingEmbed to call this prop\n- Update RenderEmbed to accept and pass through onBookingComplete\n- Update AIChat's handleEmbedShown pattern to also track booking_clicked when booking completes\n\n**Files to modify:**\n- src/components/flow/screens/AIChat.tsx (ChatBookingEmbed, RenderEmbed, AIChat)\n\n**Related:** docs/workstreams/03a-POSTHOG-FIXES.md (Fix 6 notes this gap)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-08T18:10:25.809682-08:00","created_by":"elijah","updated_at":"2026-01-08T18:26:00.811182-08:00","closed_at":"2026-01-08T18:26:00.811182-08:00","close_reason":"Implemented Calendly booking callback using useCalendlyEventListener hook. Threaded onBookingComplete through RenderEmbed, EmbeddedRafaelMessage, and CompletedEmbeddedMessage components to AIChat where it triggers analytics.trackBookingClicked({ source: 'chat' })"}
{"id":"mentorfy-ojx","title":"Implement account button with Clerk","description":"Make the account button functional using Clerk's user management.\n\n**Current state:**\n- `src/app/rafael-ai/page.tsx` lines 309-330\n- Button is visually disabled (`opacity: 0.35`, `cursor: default`)\n- No onClick handler\n\n**Options:**\n1. **Use Clerk's UserButton component** - Drop-in replacement, handles everything\n2. **Custom implementation** - Navigate to Clerk's hosted user portal\n3. **Hide for MVP** - Remove button entirely until post-launch\n\n**Recommended:** Option 1 - Use `\u003cUserButton /\u003e` from `@clerk/nextjs`\n\n**Files to modify:**\n- `src/app/rafael-ai/page.tsx`\n\n**Note:** This only matters for authenticated users. Anonymous users won't have account management.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T21:09:59.133418841Z","created_by":"eli","updated_at":"2026-01-02T15:27:12.343947-08:00","closed_at":"2026-01-02T23:08:55.790377213Z"}
{"id":"mentorfy-ono","title":"Phase 1.1: Move production apps into monorepo","description":"Create apps directory and rsync frontend + API repos into apps/web and apps/api (excluding .git, node_modules, .next, __pycache__, .venv, .ruff_cache)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-01T17:07:46.356374-08:00","created_by":"elijah","updated_at":"2026-01-01T17:08:30.696566-08:00","closed_at":"2026-01-01T17:08:30.696566-08:00","close_reason":"Closed"}
{"id":"mentorfy-p82","title":"Wire useAgent hook to /api/chat endpoint","description":"Replace mock response system with real streaming API calls.\n\n**Current state:**\n- `src/hooks/useAgent.ts` uses `mockResponses` lookup\n- Interface: `getResponse(promptKey, state, userMessage)`\n- No conversation history tracking\n- No sessionId awareness\n\n**Interface change needed:**\nThe hook signature must change to support the real API:\n```typescript\n// Before\ngetResponse(promptKey: string, state: any, userMessage: string)\n\n// After - option A: minimal change\ngetResponse(sessionId: string, messages: Message[], userMessage: string)\n\n// After - option B: cleaner\nsendMessage(content: string) // hook manages sessionId + history internally\n```\n\n**Implementation:**\n1. Add `sessionId` prop or get from UserContext\n2. Track conversation history as `messages[]` array\n3. Call `POST /api/chat` with `{ sessionId, messages }`\n4. Parse SSE stream using `TextDecoderStream` or similar\n5. Accumulate streamed text and return to caller\n6. On complete, append assistant response to messages history\n\n**Error handling:**\n- 429: Show \"Slow down\" message, disable input briefly\n- 404: Session expired, create new session\n- 500: Show error, allow retry\n\n**Files to modify:**\n- `src/hooks/useAgent.ts` - rewrite\n- `src/components/rafael-ai/screens/AIChat.tsx` - update call sites\n- `src/components/rafael-ai/screens/PhaseFlow.tsx` - update call sites\n\n**Testing:**\n- Send message, verify streaming works\n- Send 6 messages rapidly, verify rate limit handled\n- Refresh page, verify history preserved\n\n**Depends on:** mentorfy-yfp (session init)","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-02T21:08:36.83881105Z","created_by":"eli","updated_at":"2026-01-02T21:38:02.50233315Z","closed_at":"2026-01-02T21:38:02.50233315Z","close_reason":"Implemented in commit 887018a"}
{"id":"mentorfy-p94","title":"Implement Supermemory client wrapper","description":"Create lib/supermemory.ts - minimal wrapper for chat context retrieval.\n\nFunctions:\n- searchMemories(containerId: string, query: string): Promise\u003cstring[]\u003e\n  Semantic search for relevant context given user message\n  \n- writeMemory(containerId: string, content: string): Promise\u003cvoid\u003e\n  Fire-and-forget write (don't await in request path)\n  Used by chat endpoint to save: conversation turns + structured context on first chat\n\nContainer naming: {org_id}-{session_uuid}\n\nPARALLEL: Can be done simultaneously with mentorfy-b7h (sessions table) - no dependencies between them.\n\nDepends on: mentorfy-x9b (env setup)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T08:44:35.398636977Z","created_by":"eli","updated_at":"2026-01-02T09:52:36.093041939Z","closed_at":"2026-01-02T09:52:36.093048221Z"}
{"id":"mentorfy-qmd","title":"Phase 2.1: Copy prototype files into web app","description":"Copy rafael-ai route, components, context, hooks, and data files into apps/web (flat structure, no nested rafael-ai subdirs for context/data)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-01T17:03:04.061513-08:00","created_by":"elijah","updated_at":"2026-01-01T17:30:00.31638-08:00","closed_at":"2026-01-01T17:30:00.31638-08:00","close_reason":"Closed"}
{"id":"mentorfy-qtj","title":"Add streaming to diagnosis generation","description":"The /api/generate/[type] endpoint currently uses generateText() which waits for the entire response before returning. Switch to streamText() to reduce perceived latency - users will see tokens appear as they're generated instead of waiting for the full response. Chat already streams correctly.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-07T12:12:16.013394-08:00","created_by":"elijah","updated_at":"2026-01-07T12:23:05.336816-08:00","closed_at":"2026-01-07T12:23:05.336816-08:00","close_reason":"Closed"}
{"id":"mentorfy-to2","title":"Link session to authenticated user","description":"Associate anonymous session with Clerk user after authentication.\n\n**Current state:**\n- Sessions are created anonymously (no clerk_user_id)\n- When user authenticates via Clerk, session remains anonymous\n- No link between Clerk user and their session\n\n**Changes needed:**\n1. After successful Clerk authentication, call `POST /api/session/[id]/link`:\n   ```json\n   {\n     \"clerk_user_id\": \"user_...\"\n   }\n   ```\n2. This enables:\n   - Higher rate limits (20/min vs 5/min for chat)\n   - User can resume session from other devices\n   - Analytics tied to actual user\n\n**Backend endpoint:** `POST /api/session/[id]/link` - fully implemented\n\n**Files to modify:**\n- Auth callback handler or Clerk event listener\n\n**Depends on:** mentorfy-yfp (session init)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T21:10:09.998742295Z","created_by":"eli","updated_at":"2026-01-07T12:13:21.524431-08:00","closed_at":"2026-01-07T12:13:21.524431-08:00","close_reason":"wontfix"}
{"id":"mentorfy-u46","title":"Phase 3.1: Remove prototype source files","description":"Delete src/, next-app/, package.json, pnpm-lock.yaml, tsconfig.json, next.config.ts, postcss.config.mjs, eslint.config.mjs, next-env.d.ts from monorepo root","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-01T17:03:14.017752-08:00","created_by":"elijah","updated_at":"2026-01-01T17:35:47.146739-08:00","closed_at":"2026-01-01T17:35:47.146739-08:00","close_reason":"Closed"}
{"id":"mentorfy-u7z","title":"Multi-Mentor Architecture","description":"Decouple the application from Rafael Tats' specific flow so that adding a new mentor/client requires only adding configuration files, not code changes.\n\nSee docs/workstreams/02-MULTI-MENTOR.md for full plan.\n\n## Why Now\nLaunching with a different client, not Rafael. Rafael Tats is just the dev reference. The launch client needs their own flow.\n\n## Success Criteria\n- Rafael flow works exactly as before (regression test)\n- Can navigate to /rafael-tats and complete flow\n- Can create new flow file and access at /new-flow\n- No hardcoded 'rafael' references in shared code","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-07T13:34:19.965272-08:00","created_by":"elijah","updated_at":"2026-01-07T14:44:18.635862-08:00","closed_at":"2026-01-07T14:44:18.635862-08:00","close_reason":"Closed"}
{"id":"mentorfy-u7z.1","title":"Create flow definition schema","description":"Create the foundational type system and registry for flow definitions.\n\n## Source Files (read these first)\n- `src/data/rafael-ai/phases.ts` - Current phase/step definitions to convert\n- `src/data/rafael-ai/mentor.ts` - Current mentor config to merge in\n- `docs/workstreams/02-MULTI-MENTOR.md` - Full schema reference\n\n## Files to Create\n\n### 1. src/data/flows/types.ts\n```typescript\nexport interface FlowDefinition {\n  id: string\n  mentor: MentorConfig\n  phases: PhaseConfig[]\n  agents: AgentConfig\n  embeds: EmbedConfig\n}\n\nexport interface MentorConfig {\n  name: string\n  handle: string\n  avatar: string\n  welcome: {\n    title: string\n    subtitle: string\n    videoUrl?: string\n  }\n}\n\nexport interface PhaseConfig {\n  id: number\n  name: string\n  steps: StepConfig[]\n}\n\nexport interface StepConfig {\n  type: 'question' | 'ai-moment' | 'sales-page'\n  question?: string\n  questionType?: 'multiple-choice' | 'long-answer' | 'contact-info'\n  options?: { label: string; value: string }[]\n  stateKey?: string\n  fields?: ContactField[]\n  promptKey?: string\n  skipThinking?: boolean\n  headline?: string\n  copyAboveVideo?: string\n  copyBelowVideo?: string\n  calendlyUrl?: string\n}\n\nexport interface ContactField {\n  key: string\n  label: string\n  type: 'text' | 'email' | 'tel'\n  placeholder: string\n  autoComplete?: string\n}\n\nexport interface AgentConfig {\n  chat: { model: string; maxTokens: number; temperature: number }\n  diagnosis?: { model: string; maxTokens: number }\n  summary?: { model: string; maxTokens: number }\n}\n\nexport interface EmbedConfig {\n  checkoutAfterPhase?: number\n  bookingAfterPhase?: number\n  checkoutPlanId?: string\n  calendlyUrl?: string\n}\n```\n\n### 2. src/data/flows/index.ts\n```typescript\nimport { rafaelTatsFlow } from './rafael-tats'\nimport type { FlowDefinition } from './types'\n\nconst flows: Record\u003cstring, FlowDefinition\u003e = {\n  'rafael-tats': rafaelTatsFlow,\n}\n\nexport function getFlow(flowId: string): FlowDefinition {\n  const flow = flows[flowId]\n  if (\\!flow) throw new Error(\\`Flow not found: \\${flowId}\\`)\n  return flow\n}\n\nexport function getAllFlowIds(): string[] {\n  return Object.keys(flows)\n}\n\nexport type { FlowDefinition, PhaseConfig, StepConfig } from './types'\n```\n\n### 3. src/data/flows/rafael-tats.ts\nConvert phases.ts + mentor.ts into a single FlowDefinition. Key mappings:\n- `mentor.name` → `flow.mentor.name`\n- `mentor.whopPlanId` → `flow.embeds.checkoutPlanId`\n- `mentor.calendlyUrl` → `flow.embeds.calendlyUrl`\n- `phases[]` → `flow.phases[]` (structure stays similar)\n- Add `flow.agents` with model configs from current agent files\n\n## Acceptance Criteria\n- [ ] Types compile with no errors\n- [ ] `getFlow('rafael-tats')` returns valid FlowDefinition\n- [ ] All 4 phases and all steps from phases.ts are present\n- [ ] Existing code still works (this is additive, no breaking changes)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-07T13:35:03.811613-08:00","created_by":"elijah","updated_at":"2026-01-07T14:01:23.811991-08:00","closed_at":"2026-01-07T14:01:23.811991-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mentorfy-u7z.1","depends_on_id":"mentorfy-u7z","type":"parent-child","created_at":"2026-01-07T13:35:03.817707-08:00","created_by":"daemon"}]}
{"id":"mentorfy-u7z.2","title":"Wire flow_id through session and chat","description":"Update backend APIs to load flow configuration dynamically based on session's flow_id.\n\n## Files to Modify\n\n### 1. src/app/api/session/route.ts\nAdd flow_id to session creation:\n```typescript\n// In POST handler, add to destructuring:\nconst { clerk_org_id, clerk_user_id, context, flow_id } = await req.json()\n\n// Add validation:\nif (\\!flow_id) {\n  return NextResponse.json({ error: 'flow_id required' }, { status: 400 })\n}\n\n// Add to insert:\n.insert({\n  id: sessionId,\n  clerk_org_id,\n  clerk_user_id: clerk_user_id || null,\n  flow_id,  // ← ADD THIS\n  supermemory_container: supermemoryContainer,\n  status: 'active',\n  context: context || {},\n})\n```\n\n### 2. src/context/UserContext.tsx\nPass flow_id when creating session (around line 396):\n```typescript\nconst res = await fetch('/api/session', {\n  method: 'POST',\n  headers: { 'Content-Type': 'application/json' },\n  body: JSON.stringify({ \n    clerk_org_id: CLERK_ORG_ID,\n    flow_id: 'rafael-tats'  // ← ADD THIS (hardcode for now)\n  })\n})\n```\n\n### 3. src/app/api/chat/route.ts\nReplace hardcoded phases import with dynamic flow loading:\n```typescript\n// REMOVE this import:\nimport { phases } from '@/data/rafael-ai/phases'\n\n// ADD this import:\nimport { getFlow } from '@/data/flows'\n\n// Around line 140, REPLACE:\nconst availableEmbeds = getAvailableEmbeds(completedPhases, phases as any)\n\n// WITH:\nconst flow = getFlow(sessionData.flow_id || 'rafael-tats')\nconst availableEmbeds = getAvailableEmbedsFromConfig(completedPhases, flow.embeds)\n```\n\n### 4. src/lib/embed-resolver.ts\nAdd a simpler function that takes EmbedConfig directly:\n```typescript\nimport type { EmbedConfig } from '@/data/flows/types'\n\n// ADD this new function (keep the old one for now):\nexport function getAvailableEmbedsFromConfig(\n  completedPhaseIds: number[],\n  embedConfig: EmbedConfig\n): AvailableEmbeds {\n  const result: AvailableEmbeds = {}\n  \n  // Check if user has completed the required phase\n  const maxCompletedPhase = Math.max(...completedPhaseIds, 0)\n  \n  if (embedConfig.checkoutAfterPhase \u0026\u0026 maxCompletedPhase \u003e= embedConfig.checkoutAfterPhase) {\n    result.checkoutPlanId = embedConfig.checkoutPlanId\n  }\n  \n  if (embedConfig.bookingAfterPhase \u0026\u0026 maxCompletedPhase \u003e= embedConfig.bookingAfterPhase) {\n    result.calendlyUrl = embedConfig.calendlyUrl\n  }\n  \n  return result\n}\n```\n\n## Acceptance Criteria\n- [ ] POST /api/session requires flow_id and stores it\n- [ ] New sessions have flow_id='rafael-tats'\n- [ ] Chat API loads embeds from flow definition\n- [ ] Remove comment 'Hardcoded for Rafael' from chat route\n- [ ] Existing chat functionality still works","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-07T13:35:16.578843-08:00","created_by":"elijah","updated_at":"2026-01-07T14:06:29.375308-08:00","closed_at":"2026-01-07T14:06:29.375308-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mentorfy-u7z.2","depends_on_id":"mentorfy-u7z","type":"parent-child","created_at":"2026-01-07T13:35:16.581805-08:00","created_by":"daemon"},{"issue_id":"mentorfy-u7z.2","depends_on_id":"mentorfy-u7z.1","type":"blocks","created_at":"2026-01-07T13:35:16.583323-08:00","created_by":"daemon"}]}
{"id":"mentorfy-u7z.3","title":"Create generic flow page and components","description":"Create the dynamic [flowId] route and generic components to render any flow.\n\n## Files to Create\n\n### 1. src/app/api/flow/[flowId]/route.ts\n```typescript\nimport { NextResponse } from 'next/server'\nimport { getFlow } from '@/data/flows'\n\nexport async function GET(\n  req: Request,\n  { params }: { params: { flowId: string } }\n) {\n  try {\n    const flow = getFlow(params.flowId)\n    return NextResponse.json(flow)\n  } catch (err) {\n    return NextResponse.json({ error: 'Flow not found' }, { status: 404 })\n  }\n}\n```\n\n### 2. src/components/flow/StepRenderer.tsx\n```typescript\n'use client'\nimport type { FlowDefinition, StepConfig } from '@/data/flows/types'\n// Import existing components from this directory (after rename)\nimport { QuestionStep } from './screens/PhaseFlow'  // or wherever it lives\nimport { AIMoment } from './screens/PhaseFlow'\nimport { SalesPage } from './screens/PhaseFlow'\n\ninterface Props {\n  flow: FlowDefinition\n  step: StepConfig | undefined\n}\n\nexport function StepRenderer({ flow, step }: Props) {\n  if (!step) return \u003cdiv\u003eNo step\u003c/div\u003e\n  \n  switch (step.type) {\n    case 'question':\n      return \u003cQuestionStep step={step} /\u003e\n    case 'ai-moment':\n      return \u003cAIMoment step={step} flow={flow} /\u003e\n    case 'sales-page':\n      return \u003cSalesPage step={step} flow={flow} /\u003e\n    default:\n      return \u003cdiv\u003eUnknown step type\u003c/div\u003e\n  }\n}\n```\n\n### 3. src/app/[flowId]/page.tsx\nMove logic from src/app/rafael-ai/page.tsx here. Key changes:\n- Fetch flow definition from /api/flow/[flowId]\n- Use flow.mentor for mentor info instead of hardcoded import\n- Use flow.phases instead of hardcoded phases import\n\n```typescript\n'use client'\nimport { useState, useEffect } from 'react'\nimport { useUser } from '@/context/UserContext'\nimport type { FlowDefinition } from '@/data/flows/types'\n// ... other imports from components/flow/\n\nexport default function FlowPage({ params }: { params: { flowId: string } }) {\n  const [flow, setFlow] = useState\u003cFlowDefinition | null\u003e(null)\n  const { state } = useUser()\n\n  useEffect(() =\u003e {\n    fetch(\\`/api/flow/\\${params.flowId}\\`)\n      .then(r =\u003e r.json())\n      .then(setFlow)\n      .catch(console.error)\n  }, [params.flowId])\n\n  if (!flow) return \u003cdiv\u003eLoading...\u003c/div\u003e\n\n  // Use flow.mentor, flow.phases, etc instead of hardcoded imports\n  // Rest of page logic from rafael-ai/page.tsx\n}\n```\n\n## Component Rename Process\nRename directory: `src/components/rafael-ai/` → `src/components/flow/`\n\nAfter renaming, update all imports. Find affected files:\n```bash\ngrep -r \"from '@/components/rafael-ai\" src/\n```\n\nUpdate each import path from `@/components/rafael-ai/...` to `@/components/flow/...`\n\n## Key Files to Reference\n- `src/app/rafael-ai/page.tsx` - Main page logic to migrate (500+ lines)\n- `src/components/rafael-ai/screens/PhaseFlow.tsx` - Step rendering logic\n- `src/components/rafael-ai/screens/AIChat.tsx` - Chat component\n\n## Acceptance Criteria\n- [ ] GET /api/flow/rafael-tats returns flow definition\n- [ ] /rafael-tats URL renders the flow correctly\n- [ ] All components moved to src/components/flow/\n- [ ] No imports reference old `rafael-ai` component path\n- [ ] Flow renders using flow definition, not hardcoded imports\n- [ ] Chat still works within the flow","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-07T13:35:32.239138-08:00","created_by":"elijah","updated_at":"2026-01-07T14:11:11.640689-08:00","closed_at":"2026-01-07T14:11:11.640689-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mentorfy-u7z.3","depends_on_id":"mentorfy-u7z","type":"parent-child","created_at":"2026-01-07T13:35:32.242791-08:00","created_by":"daemon"},{"issue_id":"mentorfy-u7z.3","depends_on_id":"mentorfy-u7z.1","type":"blocks","created_at":"2026-01-07T13:35:32.244204-08:00","created_by":"daemon"}]}
{"id":"mentorfy-u7z.4","title":"Delete Rafael-specific files","description":"Clean up old Rafael-specific files after migration is complete and verified.\n\n## Pre-Cleanup Verification\nRun these checks BEFORE deleting anything:\n\n```bash\n# 1. Build passes\nbun run build\n\n# 2. App starts\nbun run dev\n\n# 3. Manual test: complete flow at /rafael-tats\n#    - Go through all 4 phases\n#    - Verify AI moments generate\n#    - Verify chat works\n#    - Verify sales page renders\n```\n\n## Files to Delete\n```bash\n# Delete old directories\nrm -rf src/app/rafael-ai/\nrm -rf src/data/rafael-ai/\n\n# Delete old config files\nrm src/config/rafael-ai.ts\nrm src/types/rafael-ai.ts\n```\n\n## Files to Keep\n- `src/agents/rafael/` - Keep these! Agent prompts stay per-mentor\n\n## Post-Cleanup Verification\n```bash\n# 1. Check no old imports remain\ngrep -r \"rafael-ai\" src/\n# Should return nothing (except maybe comments)\n\n# 2. Check no broken imports\nbun run build\n\n# 3. Verify the app still works\nbun run dev\n# Test /rafael-tats flow end-to-end\n```\n\n## Cleanup Checklist\n- [ ] Verified /rafael-tats works before cleanup\n- [ ] Deleted src/app/rafael-ai/\n- [ ] Deleted src/data/rafael-ai/\n- [ ] Deleted src/config/rafael-ai.ts\n- [ ] Deleted src/types/rafael-ai.ts\n- [ ] Kept src/agents/rafael/ (intentionally)\n- [ ] No grep hits for 'rafael-ai' in src/\n- [ ] Build passes\n- [ ] /rafael-tats still works after cleanup\n\n## Acceptance Criteria\n- [ ] No files with 'rafael-ai' in path remain\n- [ ] src/agents/rafael/ still exists (this is correct)\n- [ ] Build passes with no errors\n- [ ] /rafael-tats flow works end-to-end","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T13:35:47.899866-08:00","created_by":"elijah","updated_at":"2026-01-07T14:21:53.166092-08:00","closed_at":"2026-01-07T14:21:53.166092-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mentorfy-u7z.4","depends_on_id":"mentorfy-u7z","type":"parent-child","created_at":"2026-01-07T13:35:47.903062-08:00","created_by":"daemon"},{"issue_id":"mentorfy-u7z.4","depends_on_id":"mentorfy-u7z.2","type":"blocks","created_at":"2026-01-07T13:35:47.905384-08:00","created_by":"daemon"},{"issue_id":"mentorfy-u7z.4","depends_on_id":"mentorfy-u7z.3","type":"blocks","created_at":"2026-01-07T13:35:47.906283-08:00","created_by":"daemon"}]}
{"id":"mentorfy-umc","title":"test sync","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-02T22:13:22.1388135Z","created_by":"eli","updated_at":"2026-01-02T22:13:54.088795863Z","close_reason":"test issue - deleting","deleted_at":"2026-01-02T22:13:54.088795863Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mentorfy-uq5","title":"Growth Operator first diagnosis ignores MC answers","description":"## FAILED: Step 7 - First AI Diagnosis\n\n**Expected:**\n1. Address the user by name ('Test User')\n2. Reflect back their situation, background, experience level, time commitment, and capital\n3. Explain how the Growth Operator model works for their specific situation\n4. Transition to the open-ended questions\n\n**Actual:**\n- Does NOT address user by name\n- AI says 'I'm missing some key context' and asks about background/time commitment\n- User already provided this info in MC questions:\n  - Situation: Self-employed or freelancing\n  - Background: Sales or business development\n  - Experience: Yes, one or two attempts\n  - Time: 10-20 hours\n  - Capital: $5,000 - $10,000\n\n**Root Cause Hypothesis:**\nThe session context (MC answers) is not being passed correctly to the growthoperator-diagnosis agent when generating the first diagnosis.\n\n**Console Errors:**\n- 500 error on PATCH /api/session due to duplicate email constraint (separate issue)\n\n**Server Logs:**\n```\nSession update error: {\n  code: '23505',\n  details: 'Key (email, clerk_org_id)=(test@example.com, org_...) already exists.',\n  message: 'duplicate key value violates unique constraint'\n}\n```\n\n**Note:** The 500 error may be preventing session data from being saved/retrieved properly, which could explain why the AI doesn't have the MC answers.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-08T21:39:13.882206-08:00","created_by":"elijah","updated_at":"2026-01-08T21:45:22.821694-08:00","closed_at":"2026-01-08T21:45:22.821694-08:00","close_reason":"Closed"}
{"id":"mentorfy-vgy","title":"Missing Phase 1 completion screen and chat checkpoint","description":"During E2E testing of Rafael TATS flow:\n\n**Expected (per test plan):**\n- After Step 1.6 (AI Diagnosis), show Phase 1 completion/congratulations screen (Step 1.7)\n- Click Continue to proceed to Chat interface (CHECKPOINT 1)\n- In Chat, test 'book me' command - should NOT show Calendly widget yet\n- Then proceed to Phase 2\n\n**Actual:**\n- After AI Diagnosis, flow jumps directly to Phase 2 Step 2.1 ('What do you check first after posting?')\n- No Phase 1 completion screen shown\n- No Chat checkpoint available between Phase 1 and Phase 2\n\nThis prevents testing the critical 'booking widget not available until Phase 4' assertion at CHECKPOINT 1.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-07T17:47:27.886444-08:00","created_by":"elijah","updated_at":"2026-01-07T17:57:35.867317-08:00","closed_at":"2026-01-07T17:57:35.867317-08:00","close_reason":"Fixed race condition in phase completion. PhaseFlow now calls onComplete() before server state updates, preventing component unmount before callback fires."}
{"id":"mentorfy-vk9","title":"Browser E2E verification","description":"Verify the complete flow works in an actual browser, not just curl.\n\n**Tests needed:**\n1. Clear localStorage, load app fresh\n2. Verify session created (Network tab)\n3. Complete phase 1 form\n4. Verify PATCH sent with context\n5. Navigate to chat, send message\n6. Verify streaming renders in UI\n7. Refresh page\n8. Verify session restored\n9. Verify chat history preserved\n10. Verify user context preserved\n\n**Why this matters:**\nCurl tests verified API layer, but localStorage hydration and React state need browser testing.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T21:47:46.560972972Z","created_by":"eli","updated_at":"2026-01-02T14:48:47.651032-08:00","closed_at":"2026-01-02T14:48:47.651032-08:00","close_reason":"Browser E2E verification complete. Created Playwright test suite (e2e/session-flow.spec.ts) with 5 tests covering: fresh session creation, phase 1 form flow with PATCH, chat messaging, page refresh session restoration, and context preservation. All tests pass. Run with: pnpm test:e2e"}
{"id":"mentorfy-vld","title":"Missing @growthoperator handle on landing page","description":"## FAILED: Phase 0 - Landing Page Verification\n\n**Expected:** Mentor Badge showing `@growthoperator` handle visible below/near the Brady Badour name\n\n**Actual:** Only shows \"Brady Badour\" with a verified checkmark icon. No @growthoperator handle is displayed.\n\n**Screenshot:** .playwright-mcp/phase0-landing-page.png\n\n**Test Plan Reference:** docs/GROWTHOPERATOR_V2_E2E_TEST_PLAN.md - Phase 0\n\n**Console Errors:** None related to this issue","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-09T18:38:25.276257-08:00","created_by":"elijah","updated_at":"2026-01-09T18:43:59.286015-08:00","closed_at":"2026-01-09T18:43:59.286015-08:00","close_reason":"Not a bug - requirement removed from test plan"}
{"id":"mentorfy-wb7","title":"State Management Refactor","description":"Replace optimistic sync with server-as-truth model. Fixes progress loss bug where users lose data on page refresh during debounce window. See docs/workstreams/01-STATE-MANAGEMENT.md for full plan.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-07T13:23:53.076262-08:00","created_by":"elijah","updated_at":"2026-01-07T14:08:47.337537-08:00","closed_at":"2026-01-07T14:08:47.337537-08:00","close_reason":"Closed"}
{"id":"mentorfy-wb7.1","title":"Database: Add new columns + migrate data","description":"Add flow_id, current_step_id, answers columns to sessions table. Migrate existing context data to new schema. Keep context column for rollback.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T13:23:59.378363-08:00","created_by":"elijah","updated_at":"2026-01-07T13:31:30.906261-08:00","closed_at":"2026-01-07T13:31:30.906261-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mentorfy-wb7.1","depends_on_id":"mentorfy-wb7","type":"parent-child","created_at":"2026-01-07T13:23:59.381742-08:00","created_by":"daemon"}]}
{"id":"mentorfy-wb7.2","title":"Backend: /api/flow/step + schema updates","description":"Create POST /api/flow/step endpoint. Update GET/PATCH /api/session/[id] for new schema. Update /api/chat to derive completed phases from current_step_id.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T13:24:05.027791-08:00","created_by":"elijah","updated_at":"2026-01-07T13:38:31.805963-08:00","closed_at":"2026-01-07T13:38:31.805963-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mentorfy-wb7.2","depends_on_id":"mentorfy-wb7","type":"parent-child","created_at":"2026-01-07T13:24:05.031092-08:00","created_by":"daemon"},{"issue_id":"mentorfy-wb7.2","depends_on_id":"mentorfy-wb7.1","type":"blocks","created_at":"2026-01-07T13:24:38.726639-08:00","created_by":"daemon"}]}
{"id":"mentorfy-wb7.3","title":"Frontend: UserContext rewrite + component updates","description":"Rewrite UserContext.tsx (517→~100 lines). Remove sync/debounce logic. Add completeStep() function. Update PhaseFlow.tsx to use completeStep() instead of dispatch.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T13:24:10.228196-08:00","created_by":"elijah","updated_at":"2026-01-07T13:51:05.051109-08:00","closed_at":"2026-01-07T13:51:05.051109-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mentorfy-wb7.3","depends_on_id":"mentorfy-wb7","type":"parent-child","created_at":"2026-01-07T13:24:10.233106-08:00","created_by":"daemon"},{"issue_id":"mentorfy-wb7.3","depends_on_id":"mentorfy-wb7.2","type":"blocks","created_at":"2026-01-07T13:24:38.756996-08:00","created_by":"daemon"}]}
{"id":"mentorfy-wbp","title":"Flow Bug Fixes","description":"One-off fixes discovered during web app testing","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-07T14:32:06.297152-08:00","created_by":"elijah","updated_at":"2026-01-07T15:57:05.878494-08:00","closed_at":"2026-01-07T15:57:05.878494-08:00","close_reason":"Closed"}
{"id":"mentorfy-wbp.1","title":"Refresh mid-flow resets to Phase 1 contact info step","description":"Refreshing mid-flow while on Phase 3 took user back to Phase 1 and the contact info step. State restoration on refresh is broken.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T14:32:20.449461-08:00","created_by":"elijah","updated_at":"2026-01-07T15:04:25.160923-08:00","closed_at":"2026-01-07T15:04:25.160923-08:00","close_reason":"Fixed: deep merge context in API + robust hydration in frontend","dependencies":[{"issue_id":"mentorfy-wbp.1","depends_on_id":"mentorfy-wbp","type":"parent-child","created_at":"2026-01-07T14:32:20.452093-08:00","created_by":"daemon"}]}
{"id":"mentorfy-wbp.1.1","title":"Investigate and root cause","description":"Debug why refreshing mid-flow resets state to Phase 1 contact info step. Check session restoration, state persistence, and UserContext hydration.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T14:34:36.522988-08:00","created_by":"elijah","updated_at":"2026-01-07T14:54:58.283054-08:00","closed_at":"2026-01-07T14:54:58.283054-08:00","close_reason":"Root cause identified: shallow context merge in PATCH API","dependencies":[{"issue_id":"mentorfy-wbp.1.1","depends_on_id":"mentorfy-wbp.1","type":"parent-child","created_at":"2026-01-07T14:34:36.523783-08:00","created_by":"daemon"}]}
{"id":"mentorfy-wbp.1.2","title":"Prepare implementation plan","description":"Design pragmatic, elegant fix for the state restoration bug.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T14:34:36.764111-08:00","created_by":"elijah","updated_at":"2026-01-07T14:54:58.625892-08:00","closed_at":"2026-01-07T14:54:58.625892-08:00","close_reason":"Plan: deep merge context objects in API and robust hydration in frontend","dependencies":[{"issue_id":"mentorfy-wbp.1.2","depends_on_id":"mentorfy-wbp.1","type":"parent-child","created_at":"2026-01-07T14:34:36.76472-08:00","created_by":"daemon"}]}
{"id":"mentorfy-wbp.1.3","title":"Execute implementation","description":"Implement the fix for state restoration on refresh.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T14:34:37.00308-08:00","created_by":"elijah","updated_at":"2026-01-07T14:54:58.918251-08:00","closed_at":"2026-01-07T14:54:58.918251-08:00","close_reason":"Fixed API deep merge and frontend hydration","dependencies":[{"issue_id":"mentorfy-wbp.1.3","depends_on_id":"mentorfy-wbp.1","type":"parent-child","created_at":"2026-01-07T14:34:37.003672-08:00","created_by":"daemon"}]}
{"id":"mentorfy-wbp.1.4","title":"Test fix with Playwright","description":"Use Playwright MCP in headless mode to verify the fix works - navigate to Phase 3, refresh, confirm state is preserved.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T14:34:37.250791-08:00","created_by":"elijah","updated_at":"2026-01-07T15:04:24.53936-08:00","closed_at":"2026-01-07T15:04:24.53936-08:00","close_reason":"Tested with Playwright - refresh now preserves flow state","dependencies":[{"issue_id":"mentorfy-wbp.1.4","depends_on_id":"mentorfy-wbp.1","type":"parent-child","created_at":"2026-01-07T14:34:37.2514-08:00","created_by":"daemon"}]}
{"id":"mentorfy-wbp.2","title":"Back navigation from diagnosis causes blank screen hang","description":"Pressing back from the diagnosis page on Phase 3 goes to the long-form question (WAI), but re-entering text causes the next screen to hang on a blank screen.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T14:32:20.705935-08:00","created_by":"elijah","updated_at":"2026-01-07T15:10:49.958947-08:00","closed_at":"2026-01-07T15:10:49.958947-08:00","close_reason":"Fixed: backHandlerRef now dispatches SET_STEP to keep global state in sync with local step index","dependencies":[{"issue_id":"mentorfy-wbp.2","depends_on_id":"mentorfy-wbp","type":"parent-child","created_at":"2026-01-07T14:32:20.706572-08:00","created_by":"daemon"}]}
{"id":"mentorfy-wbp.2.1","title":"Investigate and root cause","description":"Debug why back navigation from diagnosis then re-entering long-form text causes blank screen hang. Check step transitions and AI moment state.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T14:34:44.750282-08:00","created_by":"elijah","updated_at":"2026-01-07T15:10:38.657406-08:00","closed_at":"2026-01-07T15:10:38.657406-08:00","close_reason":"Root cause: backHandlerRef callback only updated local state but didn't dispatch SET_STEP to persist step changes","dependencies":[{"issue_id":"mentorfy-wbp.2.1","depends_on_id":"mentorfy-wbp.2","type":"parent-child","created_at":"2026-01-07T14:34:44.755506-08:00","created_by":"daemon"}]}
{"id":"mentorfy-wbp.2.2","title":"Prepare implementation plan","description":"Design pragmatic, elegant fix for the blank screen hang on back navigation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T14:34:45.000113-08:00","created_by":"elijah","updated_at":"2026-01-07T15:10:38.745969-08:00","closed_at":"2026-01-07T15:10:38.745969-08:00","close_reason":"Plan: Add dispatch SET_STEP to backHandlerRef callback","dependencies":[{"issue_id":"mentorfy-wbp.2.2","depends_on_id":"mentorfy-wbp.2","type":"parent-child","created_at":"2026-01-07T14:34:45.000781-08:00","created_by":"daemon"}]}
{"id":"mentorfy-wbp.2.3","title":"Execute implementation","description":"Implement the fix for back navigation blank screen hang.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T14:34:45.250784-08:00","created_by":"elijah","updated_at":"2026-01-07T15:10:38.826328-08:00","closed_at":"2026-01-07T15:10:38.826328-08:00","close_reason":"Implementation complete in PhaseFlow.tsx:1494-1512","dependencies":[{"issue_id":"mentorfy-wbp.2.3","depends_on_id":"mentorfy-wbp.2","type":"parent-child","created_at":"2026-01-07T14:34:45.251403-08:00","created_by":"daemon"}]}
{"id":"mentorfy-wbp.2.4","title":"Test fix with Playwright","description":"Use Playwright MCP in headless mode to verify the fix - navigate to diagnosis, press back, re-enter text, confirm next screen loads.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T14:34:45.50455-08:00","created_by":"elijah","updated_at":"2026-01-07T15:10:38.901469-08:00","closed_at":"2026-01-07T15:10:38.901469-08:00","close_reason":"Tested with Playwright - no blank screen on back navigation and re-entry","dependencies":[{"issue_id":"mentorfy-wbp.2.4","depends_on_id":"mentorfy-wbp.2","type":"parent-child","created_at":"2026-01-07T14:34:45.505228-08:00","created_by":"daemon"}]}
{"id":"mentorfy-wbp.3","title":"Update agent prompts to not mention phase/step","description":"Agent prompts need to be updated so that agents know never to mention what phase/step the user is in. This breaks immersion.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T14:32:20.949807-08:00","created_by":"elijah","updated_at":"2026-01-07T15:20:35.254557-08:00","closed_at":"2026-01-07T15:20:35.254557-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mentorfy-wbp.3","depends_on_id":"mentorfy-wbp","type":"parent-child","created_at":"2026-01-07T14:32:20.950519-08:00","created_by":"daemon"}]}
{"id":"mentorfy-wbp.3.1","title":"Investigate and root cause","description":"Find all agent prompts that mention phase/step information. Identify where this context is being injected.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T14:34:53.44003-08:00","created_by":"elijah","updated_at":"2026-01-07T14:44:48.788701-08:00","closed_at":"2026-01-07T14:44:48.788701-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mentorfy-wbp.3.1","depends_on_id":"mentorfy-wbp.3","type":"parent-child","created_at":"2026-01-07T14:34:53.443362-08:00","created_by":"daemon"}]}
{"id":"mentorfy-wbp.3.2","title":"Prepare implementation plan","description":"Design pragmatic approach to remove phase/step mentions from agent responses while keeping agents contextually aware.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T14:34:53.704367-08:00","created_by":"elijah","updated_at":"2026-01-07T14:45:35.66302-08:00","closed_at":"2026-01-07T14:45:35.66302-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mentorfy-wbp.3.2","depends_on_id":"mentorfy-wbp.3","type":"parent-child","created_at":"2026-01-07T14:34:53.705112-08:00","created_by":"daemon"}]}
{"id":"mentorfy-wbp.3.3","title":"Execute implementation","description":"Update agent prompts to never mention phase/step to users.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T14:34:53.974854-08:00","created_by":"elijah","updated_at":"2026-01-07T15:20:35.137189-08:00","closed_at":"2026-01-07T15:20:35.137189-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mentorfy-wbp.3.3","depends_on_id":"mentorfy-wbp.3","type":"parent-child","created_at":"2026-01-07T14:34:53.975507-08:00","created_by":"daemon"}]}
{"id":"mentorfy-wbp.3.4","title":"Test fix with Playwright","description":"Use Playwright MCP in headless mode to trigger agent responses and verify no phase/step mentions appear in output.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T14:34:54.235089-08:00","created_by":"elijah","updated_at":"2026-01-07T15:20:35.193965-08:00","closed_at":"2026-01-07T15:20:35.193965-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mentorfy-wbp.3.4","depends_on_id":"mentorfy-wbp.3","type":"parent-child","created_at":"2026-01-07T14:34:54.235744-08:00","created_by":"daemon"}]}
{"id":"mentorfy-wbp.4","title":"Cannot book call after completing Phase 4","description":"Not able to book a call after completing Phase 4. Unclear if this is due to a state tracking bug or the tool registration downstream of that. Needs investigation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T14:32:21.196175-08:00","created_by":"elijah","updated_at":"2026-01-07T14:59:39.721932-08:00","closed_at":"2026-01-07T14:59:39.721932-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mentorfy-wbp.4","depends_on_id":"mentorfy-wbp","type":"parent-child","created_at":"2026-01-07T14:32:21.19684-08:00","created_by":"daemon"}]}
{"id":"mentorfy-wbp.4.1","title":"Investigate and root cause","description":"Debug why booking is unavailable after Phase 4 completion. Check state tracking, embed availability logic, and tool registration.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T14:35:06.845085-08:00","created_by":"elijah","updated_at":"2026-01-07T14:45:44.050132-08:00","closed_at":"2026-01-07T14:45:44.050132-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mentorfy-wbp.4.1","depends_on_id":"mentorfy-wbp.4","type":"parent-child","created_at":"2026-01-07T14:35:06.849436-08:00","created_by":"daemon"}]}
{"id":"mentorfy-wbp.4.2","title":"Prepare implementation plan","description":"Design pragmatic fix for booking availability after Phase 4 completion.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T14:35:07.14492-08:00","created_by":"elijah","updated_at":"2026-01-07T14:46:47.492825-08:00","closed_at":"2026-01-07T14:46:47.492825-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mentorfy-wbp.4.2","depends_on_id":"mentorfy-wbp.4","type":"parent-child","created_at":"2026-01-07T14:35:07.145645-08:00","created_by":"daemon"}]}
{"id":"mentorfy-wbp.4.3","title":"Execute implementation","description":"Implement the fix for booking availability.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T14:35:07.436961-08:00","created_by":"elijah","updated_at":"2026-01-07T14:59:39.517678-08:00","closed_at":"2026-01-07T14:59:39.517678-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mentorfy-wbp.4.3","depends_on_id":"mentorfy-wbp.4","type":"parent-child","created_at":"2026-01-07T14:35:07.43779-08:00","created_by":"daemon"}]}
{"id":"mentorfy-wbp.4.4","title":"Test fix with Playwright","description":"Use Playwright MCP in headless mode to complete Phase 4 and verify booking option becomes available.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T14:35:07.705773-08:00","created_by":"elijah","updated_at":"2026-01-07T14:59:39.604493-08:00","closed_at":"2026-01-07T14:59:39.604493-08:00","close_reason":"Closed","dependencies":[{"issue_id":"mentorfy-wbp.4.4","depends_on_id":"mentorfy-wbp.4","type":"parent-child","created_at":"2026-01-07T14:35:07.706427-08:00","created_by":"daemon"}]}
{"id":"mentorfy-wsk","title":"First AI Diagnosis does not address user by name","description":"## Issue\n\nDuring E2E testing of the Growth Operator flow, the First AI Diagnosis (Step 7) does not address the user by their submitted name.\n\n## Expected Behavior\nThe AI response should address the user by their first name (e.g., 'Hey Test User' or 'Hey Test').\n\n## Actual Behavior  \nThe AI response says 'Hey there!' without using the user's name.\n\n## Steps to Reproduce\n1. Navigate to /growthoperator\n2. Complete MC questions (situation, background, experience, time, capital)\n3. Fill in contact form with name 'Test User'\n4. Submit and view First AI Diagnosis\n\n## Test Data Used\n- Name: Test User\n- Email: test@example.com\n- Phone: (555) 999-8888\n- Situation: Self-employed or freelancing\n- Background: Sales or business development\n- Experience: Yes, one or two attempts\n- Time: 10-20 hours\n- Capital: $5,000 - $10,000\n\n## Test Plan Reference\ndocs/GROWTHOPERATOR_E2E_TEST_PLAN.md - Step 7, Assertion #1","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-08T22:07:24.689923-08:00","created_by":"elijah","updated_at":"2026-01-08T22:12:59.561318-08:00","closed_at":"2026-01-08T22:12:59.561318-08:00","close_reason":"Closed","labels":["growthoperator"]}
{"id":"mentorfy-x3c","title":"Define plus icon button feature","description":"The plus icon in ChatBar should allow file uploads.\n\n**Specs:**\n- **File types:** jpg, png, webp, gif, pdf\n- **Max size:** 10MB\n- **Storage:** Supabase Storage bucket `session-uploads/{sessionId}/{filename}`\n\n**Implementation needed:**\n1. Add onClick handler to plus button in `ChatBar.tsx`\n2. Create hidden file input triggered by button click\n3. Create `POST /api/upload` endpoint using Supabase Storage\n4. Display uploaded file preview in chat\n5. Include file reference when sending message to AI\n\n**Files:**\n- `src/components/rafael-ai/shared/ChatBar.tsx` - UI changes\n- `src/app/api/upload/route.ts` - new endpoint","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-02T21:10:18.777852347Z","created_by":"eli","updated_at":"2026-01-02T16:37:31.444217-08:00","closed_at":"2026-01-03T00:33:22.61070872Z"}
{"id":"mentorfy-x9b","title":"Set up backend environment and secrets","description":"Blocking setup work BEFORE implementation begins:\n\n1. Create Langfuse account at cloud.langfuse.com, get API keys\n2. Verify Supermemory API access - test write/search with curl\n3. Verify Supabase project access with service role key\n4. Create Vercel project, configure all env vars:\n   - SUPABASE_URL, SUPABASE_SERVICE_ROLE_KEY\n   - SUPERMEMORY_API_KEY\n   - NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY, CLERK_SECRET_KEY\n   - LANGFUSE_PUBLIC_KEY, LANGFUSE_SECRET_KEY, LANGFUSE_HOST\n   - NEXT_PUBLIC_POSTHOG_KEY, POSTHOG_HOST\n   - ANTHROPIC_API_KEY\n5. Document any API quirks or gotchas discovered\n\nThis unblocks all implementation issues. Do this first.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-02T08:52:59.304216092Z","created_by":"eli","updated_at":"2026-01-02T09:16:37.050402435Z","closed_at":"2026-01-02T09:16:37.050410112Z"}
{"id":"mentorfy-xfs","title":"PROD BUG: AI diagnosis content not rendering in Growth Operator flow","description":"## FAILED: Step 7 - First AI Diagnosis Moment\n\n**Environment:** Production (https://mentorfy.ai/growthoperator)\n\n**Expected:** After completing the contact form (Step 6), the AI diagnosis should appear with personalized content reflecting the user's MC answers.\n\n**Actual:** The diagnosis area is completely blank. Only a cursor appears briefly, then disappears. No text content is ever rendered.\n\n**Evidence:**\n- API call `POST /api/generate/diagnosis` returns 200 (called twice)\n- No console errors\n- Screenshot shows empty content area with only 'Continue' button visible\n\n**Steps to Reproduce:**\n1. Navigate to https://mentorfy.ai/growthoperator\n2. Clear localStorage/sessionStorage\n3. Click 'See If I Qualify'\n4. Complete Steps 1-5 (MC questions)\n5. Fill contact form (Step 6)\n6. Click Continue\n7. Observe: No AI diagnosis text appears\n\n**Test Data Used:**\n- Situation: Self-employed or freelancing\n- Background: Sales or business development\n- Experience: Yes, one or two attempts\n- Time: 10-20 hours\n- Capital: $5,000 - $10,000\n- Name: Test User\n- Email: test@example.com\n- Phone: (555) 999-8888\n\n**Impact:** Critical - Users cannot see their personalized diagnosis, breaking the entire assessment flow.\n\n**Screenshots:** .playwright-mcp/step7-diagnosis.png, .playwright-mcp/step7-after-wait.png","status":"in_progress","priority":1,"issue_type":"bug","assignee":"elijah","created_at":"2026-01-09T13:34:56.203322-08:00","created_by":"elijah","updated_at":"2026-01-09T13:40:48.992721-08:00"}
{"id":"mentorfy-xve","title":"Phase 1.2: Verify apps work","description":"Test web (pnpm install \u0026\u0026 pnpm build) and API (uv sync \u0026\u0026 uv run python start_server.py) to confirm they run in new locations","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-01T17:02:55.145456-08:00","created_by":"elijah","updated_at":"2026-01-01T17:38:35.417959-08:00","closed_at":"2026-01-01T17:38:35.417959-08:00","close_reason":"Closed"}
{"id":"mentorfy-yfp","title":"Initialize session on app load","description":"Create backend session when user first lands and persist sessionId.\n\n**Current state:**\n- No session creation call\n- UserContext only uses localStorage\n- No sessionId for API calls\n\n**Implementation:**\n1. On app mount, check localStorage for existing sessionId\n2. If exists, validate with `GET /api/session/[id]`\n   - If valid: use it, hydrate UserContext from response\n   - If 404: clear localStorage, create new session\n3. If no sessionId, call `POST /api/session` with `{ clerk_org_id }`\n4. Store sessionId in:\n   - React state (for current session)\n   - localStorage (for persistence across refreshes)\n5. Expose sessionId via UserContext or dedicated hook\n\n**Where to implement:**\nOption A: In `UserProvider` - keeps all state together\nOption B: New `useSession` hook - cleaner separation\n\n**Edge cases:**\n- User has old sessionId that was deleted → create new\n- User clears localStorage → create new\n- Clerk org changes → may need new session (TBD)\n\n**Files to modify:**\n- `src/context/UserContext.tsx` - add session management\n- `src/app/rafael-ai/page.tsx` - ensure provider wraps correctly\n\n**Note:** For MVP, hardcode `clerk_org_id`. Real multi-tenant support is separate work.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-02T21:08:51.003026735Z","created_by":"eli","updated_at":"2026-01-02T21:38:02.195543476Z","closed_at":"2026-01-02T21:38:02.195543476Z","close_reason":"Implemented in commit 887018a"}
{"id":"mentorfy-ykh","title":"Move embed URLs to mentor config","description":"Checkout plan ID and Calendly URL are hardcoded in AIChat - should come from mentor config.\n\n**Current state:**\n- `AIChat.tsx:548`: `checkoutPlanId: 'plan_joNwbFAIES0hH'` hardcoded\n- `AIChat.tsx:582`: `calendlyUrl: 'https://calendly.com/brady-mentorfy/30min'` hardcoded\n- These are mentor-specific values that shouldn't be in component code\n\n**Changes needed:**\n1. Add to `src/data/rafael-ai/mentor.ts`:\n   ```typescript\n   whopPlanId: 'plan_joNwbFAIES0hH',\n   calendlyUrl: 'https://calendly.com/...',\n   ```\n2. Import mentor config where needed\n3. When AI or sales flow triggers checkout/booking, use config values\n\n**Note:** This is separate from removing DEMO_COMMANDS (mentorfy-mv6). Even after demo commands are removed, the real embed triggers will need these values from config.\n\n**Files to modify:**\n- `src/data/rafael-ai/mentor.ts`\n- Wherever checkout/booking embeds are triggered","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T21:10:40.025049243Z","created_by":"eli","updated_at":"2026-01-02T16:37:31.445157-08:00","closed_at":"2026-01-03T00:18:01.269178072Z"}
{"id":"mentorfy-zua","title":"Growth Operator: Calendly widget not appearing for qualified users in Step 11","description":"## Bug Report\n\n**Test:** Growth Operator E2E Test Plan - Step 11 (Final AI Diagnosis)\n\n**Expected Behavior:**\nFor qualified users, the Calendly booking widget should be embedded inline with the final diagnosis.\n- Booking widget URL: https://calendly.com/brady-mentorfy/30min\n- Diagnosis text should appear ABOVE the calendar embed (via beforeText)\n\n**Actual Behavior:**\n- AI generates a positive qualification decision: \"I believe this could be a great fit for you. Let's get you set up to discuss this further.\"\n- NO Calendly widget appears\n- Only a \"Continue →\" button is shown instead of the embedded calendar\n\n**Test Data Used (Qualified Path):**\n- Situation: Self-employed or freelancing\n- Background: Sales or business development\n- Experience: Yes, one or two attempts\n- Time: 10-20 hours (qualifies - 10+ hours)\n- Capital: $5,000-$10,000 (qualifies - $5k+)\n- All three open-ended answers were thoughtful and specific\n\n**Evidence:**\n- Screenshot: .playwright-mcp/growthoperator-step11-no-calendly.png\n- Server logs show /api/generate/diagnosis returned 200 OK in 4.0s\n\n**Impact:**\nCritical - Qualified leads cannot book calls, breaking the entire conversion funnel.","status":"closed","priority":1,"issue_type":"bug","assignee":"elijah","created_at":"2026-01-09T16:27:46.292371-08:00","created_by":"elijah","updated_at":"2026-01-09T16:31:03.071803-08:00","closed_at":"2026-01-09T16:31:03.071803-08:00","close_reason":"Fixed: Client was looking for 'tool-result' events but AI SDK sends 'tool-output-available' events"}
{"id":"mt-0zi","title":"Consider Clerk afterSignInUrl for auth gate pending actions","description":"Current auth gate uses ref-based pending action storage. Works well but doesn't survive page refresh. Could use Clerk's afterSignInUrl callback for URL-based flow if this becomes a problem. Low priority - current approach is simpler and works for most cases.","status":"closed","priority":4,"issue_type":"task","created_at":"2026-01-04T04:02:26.699326384Z","created_by":"eli","updated_at":"2026-01-04T07:00:45.980667622Z","closed_at":"2026-01-04T07:00:45.980667622Z","close_reason":"Closed","dependencies":[{"issue_id":"mt-0zi","depends_on_id":"mt-9np","type":"blocks","created_at":"2026-01-04T06:49:24.370346164Z","created_by":"eli"}]}
{"id":"mt-2m3","title":"Phase 3.2: Add root-level dev files","description":"Create Makefile with install/dev/web/api targets. Optionally add docker-compose.yml for local Redis/Neo4j.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-01T17:03:14.258259-08:00","created_by":"elijah","updated_at":"2026-01-04T05:09:26.847697581Z","closed_at":"2026-01-01T17:36:54.25378-08:00","close_reason":"Closed"}
{"id":"mt-3nm","title":"Make header account button open sign-in modal","description":"In src/app/rafael-ai/page.tsx, update the SignedOut section (around line 322-345):\n\n- Add useClerk import and destructure openSignIn\n- Add onClick={() =\u003e openSignIn({})} to the button\n- Remove opacity: 0.35 (button should look active)\n- Change cursor: 'default' to cursor: 'pointer'\n\nThis is independent UI work - no dependencies on other auth issues.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T04:57:08.860879404Z","created_by":"eli","updated_at":"2026-01-04T07:06:48.530720281Z","closed_at":"2026-01-04T07:06:48.530720281Z","close_reason":"Closed","labels":["auth","ui"]}
{"id":"mt-5lp","title":"E2E flow verification","description":"Verify the complete user flow works end-to-end before going live.\n\nTest flow:\n1. POST /api/session → get sessionId\n2. PATCH /api/session/[id] with name, email, context answers\n3. POST /api/chat with a question → verify streaming response includes context\n4. POST /api/generate/diagnosis → verify output references user's answers\n5. Check Langfuse dashboard → verify traces captured with costs\n\nSuccess criteria:\n- [ ] Anonymous user can complete full flow with real AI responses\n- [ ] Context persists across chat messages\n- [ ] Langfuse shows traces with token counts and latency\n- [ ] Response latency \u003c 3s for first token\n- [ ] Rate limiting returns 429 when exceeded\n\nDepends on: mt-j52, mt-fe8, mt-fxe","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-02T08:58:26.725621262Z","created_by":"eli","updated_at":"2026-01-02T08:59:10.535159303Z","deleted_at":"2026-01-02T08:59:10.535159303Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mt-8g0","title":"Race condition: no unique constraint on (email, clerk_org_id) in sessions table","description":"When checking for returning users in PATCH /api/session/[id], the code searches for existing sessions by email without a unique constraint. If two requests arrive simultaneously with the same email, both could pass this check before either commits, creating duplicate sessions.\n\nFix: Add unique constraint:\nALTER TABLE sessions ADD CONSTRAINT sessions_email_org_unique UNIQUE (email, clerk_org_id);\n\nFound during auth gate planning review.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T02:48:31.779040233Z","created_by":"eli","updated_at":"2026-01-04T06:52:02.514253571Z","closed_at":"2026-01-04T06:52:02.514253571Z","close_reason":"Closed"}
{"id":"mt-9h2","title":"Phase 1.1: Move production apps into monorepo","description":"Create apps directory and rsync frontend + API repos into apps/web and apps/api (excluding .git, node_modules, .next, __pycache__, .venv, .ruff_cache)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-01T17:03:32.956672-08:00","created_by":"elijah","updated_at":"2026-01-04T05:09:26.74786655Z","closed_at":"2026-01-01T17:38:35.389863-08:00","close_reason":"Closed"}
{"id":"mt-9np","title":"Create useAuthGate hook","description":"Create src/hooks/useAuthGate.ts - a hook that gates phase transitions behind authentication.\n\nFeatures:\n- Stores pending action when auth modal opens\n- Detects sign-in completion via isSignedIn state change\n- Calls /api/session/[id]/link to link session after sign-in\n- Executes stored pending action after successful sign-in\n- Exposes gatePhaseTransition(completedPhase, onAllowed) function\n\nDepends on: AUTH_CONFIG being added to rafael-ai.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T04:56:59.177729039Z","created_by":"eli","updated_at":"2026-01-04T06:58:41.239296999Z","closed_at":"2026-01-04T06:58:41.239296999Z","close_reason":"Closed","labels":["auth","hook"],"dependencies":[{"issue_id":"mt-9np","depends_on_id":"mt-zqe","type":"blocks","created_at":"2026-01-04T04:57:45.190221129Z","created_by":"eli"}]}
{"id":"mt-apx","title":"Update session link endpoint for Clerk integration","description":"Update src/app/api/session/[id]/link/route.ts to:\n\n1. Get authenticated Clerk user ID from server-side auth() (don't trust client)\n2. Update session record with clerk_user_id\n3. Add user to the organization via clerkClient().organizations.createOrganizationMembership()\n4. Handle 'already_a_member_in_organization' errors gracefully\n\nThis is backend-only work, no frontend dependencies.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T04:56:59.782802429Z","created_by":"eli","updated_at":"2026-01-04T07:03:41.90997973Z","closed_at":"2026-01-04T07:03:41.90997973Z","close_reason":"Closed","labels":["api","auth"]}
{"id":"mt-d51","title":"Integrate auth gate into phase transitions","description":"In src/app/rafael-ai/page.tsx:\n\n1. Import useAuthGate hook\n2. Call useAuthGate() to get gatePhaseTransition\n3. Wrap handleInitialLevelComplete logic in gatePhaseTransition(currentPhaseNumber, () =\u003e { ... })\n4. Wrap handlePanelLevelComplete logic in gatePhaseTransition(currentPhaseNumber, () =\u003e { ... })\n\nThis ensures users must sign in after completing the configured phase before proceeding.\n\nDepends on: useAuthGate hook being created","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T04:57:00.641932356Z","created_by":"eli","updated_at":"2026-01-04T07:00:14.136430956Z","closed_at":"2026-01-04T07:00:14.136430956Z","close_reason":"Closed","labels":["auth","integration"],"dependencies":[{"issue_id":"mt-d51","depends_on_id":"mt-9np","type":"blocks","created_at":"2026-01-04T04:57:45.458210725Z","created_by":"eli"}]}
{"id":"mt-dlo","title":"Update Clerk org ID from slug to actual ID","description":"In src/context/UserContext.tsx, change CLERK_ORG_ID from 'rafael-tatts' (slug) to 'org_35wDDMLUgC1nZZLkDLtZ3A8TbJY' (actual Clerk org ID). This avoids slug resolution and matches what's stored in the sessions table.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T04:56:36.622356666Z","created_by":"eli","updated_at":"2026-01-04T06:54:35.411144262Z","closed_at":"2026-01-04T06:54:35.411144262Z","close_reason":"Closed","labels":["auth","config"]}
{"id":"mt-fqz","title":"Phase 2.2: Fix imports in copied files","description":"Rename context files if they conflict with existing ones. Run pnpm build to catch any issues.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-01T17:03:04.303608-08:00","created_by":"elijah","updated_at":"2026-01-04T05:09:26.752228126Z","closed_at":"2026-01-01T17:32:38.245597-08:00","close_reason":"Closed"}
{"id":"mt-k5u","title":"Phase 3.3: Consolidate config","description":"Merge or organize .env.example files. Update root .gitignore to include apps/*/node_modules, apps/*/.next, etc.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-01T17:03:14.504934-08:00","created_by":"elijah","updated_at":"2026-01-04T05:09:26.844715342Z","closed_at":"2026-01-01T17:38:20.881291-08:00","close_reason":"Closed"}
{"id":"mt-nj2","title":"Update deployment configs","description":"Vercel: set root directory to apps/web. Railway: set root directory to apps/api.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-01T17:03:18.649302-08:00","created_by":"elijah","updated_at":"2026-01-04T05:09:26.839129289Z","closed_at":"2026-01-01T17:38:26.025989-08:00","close_reason":"Closed"}
{"id":"mt-qmd","title":"Phase 2.1: Copy prototype files into web app","description":"Copy rafael-ai route, components, context, hooks, and data files into apps/web (flat structure, no nested rafael-ai subdirs for context/data)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-01T17:03:04.061513-08:00","created_by":"elijah","updated_at":"2026-01-04T05:09:26.755570449Z","closed_at":"2026-01-01T17:30:00.31638-08:00","close_reason":"Closed"}
{"id":"mt-to2","title":"Link session to authenticated user","description":"Associate anonymous session with Clerk user after authentication.\n\n**Current state:**\n- Sessions are created anonymously (no clerk_user_id)\n- When user authenticates via Clerk, session remains anonymous\n- No link between Clerk user and their session\n\n**Changes needed:**\n1. After successful Clerk authentication, call `POST /api/session/[id]/link`:\n   ```json\n   {\n     \"clerk_user_id\": \"user_...\"\n   }\n   ```\n2. This enables:\n   - Higher rate limits (20/min vs 5/min for chat)\n   - User can resume session from other devices\n   - Analytics tied to actual user\n\n**Backend endpoint:** `POST /api/session/[id]/link` - fully implemented\n\n**Files to modify:**\n- Auth callback handler or Clerk event listener\n\n**Depends on:** mentorfy-yfp (session init)","status":"closed","priority":2,"issue_type":"task","assignee":"eli","created_at":"2026-01-02T21:10:09.998742295Z","created_by":"eli","updated_at":"2026-01-04T06:42:31.051369736Z","closed_at":"2026-01-04T06:42:31.051369736Z","close_reason":"Superseded by mt-apx (backend) + mt-9np (frontend)"}
{"id":"mt-u46","title":"Phase 3.1: Remove prototype source files","description":"Delete src/, next-app/, package.json, pnpm-lock.yaml, tsconfig.json, next.config.ts, postcss.config.mjs, eslint.config.mjs, next-env.d.ts from monorepo root","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-01T17:03:14.017752-08:00","created_by":"elijah","updated_at":"2026-01-04T05:09:26.851823567Z","closed_at":"2026-01-01T17:35:47.146739-08:00","close_reason":"Closed"}
{"id":"mt-vk9","title":"Browser E2E verification","description":"Verify the complete flow works in an actual browser, not just curl.\n\n**Tests needed:**\n1. Clear localStorage, load app fresh\n2. Verify session created (Network tab)\n3. Complete phase 1 form\n4. Verify PATCH sent with context\n5. Navigate to chat, send message\n6. Verify streaming renders in UI\n7. Refresh page\n8. Verify session restored\n9. Verify chat history preserved\n10. Verify user context preserved\n\n**Why this matters:**\nCurl tests verified API layer, but localStorage hydration and React state need browser testing.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T21:47:46.560972972Z","created_by":"eli","updated_at":"2026-01-04T05:09:26.696940149Z","closed_at":"2026-01-02T14:48:47.651032-08:00"}
{"id":"mt-xve","title":"Phase 1.2: Verify apps work","description":"Test web (pnpm install \u0026\u0026 pnpm build) and API (uv sync \u0026\u0026 uv run python start_server.py) to confirm they run in new locations","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-01T17:02:55.145456-08:00","created_by":"elijah","updated_at":"2026-01-04T05:09:26.759192479Z","closed_at":"2026-01-01T17:38:35.417959-08:00","close_reason":"Closed"}
{"id":"mt-zqe","title":"Add AUTH_CONFIG to rafael-ai config","description":"Add AUTH_CONFIG object to src/config/rafael-ai.ts with requireAuthAfterPhase setting. This controls which phase completion triggers the sign-in requirement. Default to phase 1. Setting to null disables auth requirement entirely.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T04:56:58.749820028Z","created_by":"eli","updated_at":"2026-01-04T06:56:41.407143926Z","closed_at":"2026-01-04T06:56:41.407143926Z","close_reason":"Closed","labels":["auth","config"]}
